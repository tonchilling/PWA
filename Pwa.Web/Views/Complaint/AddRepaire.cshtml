@using Pwa.FrameWork.Dto;
@using Pwa.FrameWork.Dto.Smart1662;
@using Pwa.FrameWork.Dto.Utils;
@using Pwa.FrameWork.Dto.Smart1662.RepaireWork;
@using Pwa.FrameWork.Dao.EF.Smart1662;
@using Pwa.FrameWork.Dto.Smart1662.Incident;
@using Pwa.FrameWork.Dto.Smart1662;
@{
    /**/

    ViewBag.Title = "AddRepaire";
    Layout = "~/Views/Shared/_Layout.cshtml";

    UserInfoDto currentUser = (UserInfoDto)ViewBag.CurrentUser;
    List<DropDownlistDto> sysRequestTypes = (List<DropDownlistDto>
)ViewBag.SysRequestType;

    List<DropDownlistDto> SysRequestCategorys = (List<DropDownlistDto>
    )ViewBag.SysRequestCategorys;

    List<DropDownlistDto> SysRequestCategorySubjects = (List<DropDownlistDto>
    )ViewBag.SysRequestCategorySubjects;

    List<DropDownlistDto> SysItems = (List<DropDownlistDto>
    )ViewBag.SysItems;

    List<DropDownlistDto> SysUnit = (List<DropDownlistDto>
    )ViewBag.SysUnit;

    List<DropDownlistDto> SysBranch = (List<DropDownlistDto>
    )ViewBag.SysBranch;

    List<DropDownlistDto> Employees = (List<DropDownlistDto>
    )ViewBag.Employees;

    List<DropDownlistDto> SysGISPIPETYPE = (List<DropDownlistDto>
 )ViewBag.SysGISPIPETYPE;
    List<DropDownlistDto> SysPipelineSize = (List<DropDownlistDto>
)ViewBag.SysPipelineSize;

    List<DropDownlistDto> SysSurface = (List<DropDownlistDto>
)ViewBag.SysSurface;


    List<DropDownlistDto> SysTeam = (List<DropDownlistDto>
)ViewBag.SysTeam;




    List<IncidentDto> incidentList = (List<IncidentDto>
)ViewBag.GetIncidents;
    FileDto fileDto = null;
}

@model PwaRepaireWorkHeaderDto
<style>
    .html2canvas-container {
        width: 3000px !important;
        height: 3000px !important;
    }

    .table thead tr.bg-success th {
        font-weight: 400;
        color: #fff;
        border-bottom-width: 1
    }




    /*   .popover {
        height: 400px;
        width: auto;
    }

    .popover img {
        height: 100%;
        width: auto;
    }*/

   .mapdefault {
        height: 400px;
        width: 100%;
    }

    #mapid {
        height: 100%;
        position: absolute;
        width: 100%;
    }

    #maphistoryid {
        height: 400px;
        width: 100%;
    }

    .panel-heading {
        display: flex
    }

        .panel-heading .form-group {
            padding-top: 20px;
        }

    .pull-right {
        right: 0;
    }

    .btnDeleteMaker {
     cursor:pointer;
    }



    .select2-container--default .select2-dropdown {
        z-index: 1710;
    }

    .select2-results__options {
        z-index: 1700;
    }
    .btnExpandMap {
        position: absolute;
        right: 20px;
        bottom: 100px;
        padding: 10px;
        z-index: 400;
    }

    .fullScreen {
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        height: 100%;
        z-index: 1700;
    }

    .mapfull {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
    }

    .divSurveyToolSectionMap > .divSurveyTool {
        z-index: 1701;
        top: 100px;
        left: 5px;
        height: 80%;
        width:25%;
        position:absolute;
        background-color:#fff;
        overflow-y:auto;
        overflow-x:hidden;
    }

    .divBranchMap {
        z-index: 1000;
        position: absolute;
        width: 20%;
        top: 10px;
        left: 50px;
    }


    .btnStreetView {
        position: absolute;
        width: 40px;
        height: 40px;
        right: 10px;
        top: 280px;
        padding: 10px;
        z-index: 400;
        border: none;
        background-size: cover;
        background-image: url("/Content/assets/images/street-view.png");
    }

    #streetPanorama {
        right: 30px;
        top: 5px;
        width: 300px;
        height: 280px;
        position: absolute;
        z-index: 400;
    }



    .leaflet-control-easyPrint-button {
        background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDUxMiA1MTI7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8cGF0aCBkPSJNMTI4LDMyaDI1NnY2NEgxMjhWMzJ6IE00ODAsMTI4SDMyYy0xNy42LDAtMzIsMTQuNC0zMiwzMnYxNjBjMCwxNy42LDE0LjM5OCwzMiwzMiwzMmg5NnYxMjhoMjU2VjM1Mmg5NiAgIGMxNy42LDAsMzItMTQuNCwzMi0zMlYxNjBDNTEyLDE0Mi40LDQ5Ny42LDEyOCw0ODAsMTI4eiBNMzUyLDQ0OEgxNjBWMjg4aDE5MlY0NDh6IE00ODcuMTk5LDE3NmMwLDEyLjgxMy0xMC4zODcsMjMuMi0yMy4xOTcsMjMuMiAgIGMtMTIuODEyLDAtMjMuMjAxLTEwLjM4Ny0yMy4yMDEtMjMuMnMxMC4zODktMjMuMiwyMy4xOTktMjMuMkM0NzYuODE0LDE1Mi44LDQ4Ny4xOTksMTYzLjE4Nyw0ODcuMTk5LDE3NnoiIGZpbGw9IiMwMDAwMDAiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K);
        background-size: 16px 16px;
        cursor: pointer;
    }

    .leaflet-control-easyPrint-button-export {
        background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDQzMy41IDQzMy41IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0MzMuNSA0MzMuNTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxnIGlkPSJmaWxlLWRvd25sb2FkIj4KCQk8cGF0aCBkPSJNMzk1LjI1LDE1M2gtMTAyVjBoLTE1M3YxNTNoLTEwMmwxNzguNSwxNzguNUwzOTUuMjUsMTUzeiBNMzguMjUsMzgyLjV2NTFoMzU3di01MUgzOC4yNXoiIGZpbGw9IiMwMDAwMDAiLz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K);
        background-size: 16px 16px;
        cursor: pointer;
    }

    .easyPrintHolder a {
        background-size: 16px 16px;
        cursor: pointer;
    }

    .easyPrintHolder .CurrentSize {
        background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTZweCIgdmVyc2lvbj0iMS4xIiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNjQgNjQiPgogIDxnPgogICAgPGcgZmlsbD0iIzFEMUQxQiI+CiAgICAgIDxwYXRoIGQ9Ik0yNS4yNTUsMzUuOTA1TDQuMDE2LDU3LjE0NVY0Ni41OWMwLTEuMTA4LTAuODk3LTIuMDA4LTIuMDA4LTIuMDA4QzAuODk4LDQ0LjU4MiwwLDQ1LjQ4MSwwLDQ2LjU5djE1LjQwMiAgICBjMCwwLjI2MSwwLjA1MywwLjUyMSwwLjE1NSwwLjc2N2MwLjIwMywwLjQ5MiwwLjU5NCwwLjg4MiwxLjA4NiwxLjA4N0MxLjQ4Niw2My45NDcsMS43NDcsNjQsMi4wMDgsNjRoMTUuNDAzICAgIGMxLjEwOSwwLDIuMDA4LTAuODk4LDIuMDA4LTIuMDA4cy0wLjg5OC0yLjAwOC0yLjAwOC0yLjAwOEg2Ljg1NWwyMS4yMzgtMjEuMjRjMC43ODQtMC43ODQsMC43ODQtMi4wNTUsMC0yLjgzOSAgICBTMjYuMDM5LDM1LjEyMSwyNS4yNTUsMzUuOTA1eiIgZmlsbD0iIzAwMDAwMCIvPgogICAgICA8cGF0aCBkPSJtNjMuODQ1LDEuMjQxYy0wLjIwMy0wLjQ5MS0wLjU5NC0wLjg4Mi0xLjA4Ni0xLjA4Ny0wLjI0NS0wLjEwMS0wLjUwNi0wLjE1NC0wLjc2Ny0wLjE1NGgtMTUuNDAzYy0xLjEwOSwwLTIuMDA4LDAuODk4LTIuMDA4LDIuMDA4czAuODk4LDIuMDA4IDIuMDA4LDIuMDA4aDEwLjU1NmwtMjEuMjM4LDIxLjI0Yy0wLjc4NCwwLjc4NC0wLjc4NCwyLjA1NSAwLDIuODM5IDAuMzkyLDAuMzkyIDAuOTA2LDAuNTg5IDEuNDIsMC41ODlzMS4wMjctMC4xOTcgMS40MTktMC41ODlsMjEuMjM4LTIxLjI0djEwLjU1NWMwLDEuMTA4IDAuODk3LDIuMDA4IDIuMDA4LDIuMDA4IDEuMTA5LDAgMi4wMDgtMC44OTkgMi4wMDgtMi4wMDh2LTE1LjQwMmMwLTAuMjYxLTAuMDUzLTAuNTIyLTAuMTU1LTAuNzY3eiIgZmlsbD0iIzAwMDAwMCIvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg==)
    }

    .easyPrintHolder .page {
        background-image: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMS4xLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ0NC44MzMgNDQ0LjgzMyIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjgzMyA0NDQuODMzOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMnB4IiBoZWlnaHQ9IjUxMnB4Ij4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNNTUuMjUsNDQ0LjgzM2gzMzQuMzMzYzkuMzUsMCwxNy03LjY1LDE3LTE3VjEzOS4xMTdjMC00LjgxNy0xLjk4My05LjM1LTUuMzgzLTEyLjQ2N0wyNjkuNzMzLDQuNTMzICAgIEMyNjYuNjE3LDEuNywyNjIuMzY3LDAsMjU4LjExNywwSDU1LjI1Yy05LjM1LDAtMTcsNy42NS0xNywxN3Y0MTAuODMzQzM4LjI1LDQzNy4xODMsNDUuOSw0NDQuODMzLDU1LjI1LDQ0NC44MzN6ICAgICBNMzcyLjU4MywxNDYuNDgzdjAuODVIMjU2LjQxN3YtMTA4LjhMMzcyLjU4MywxNDYuNDgzeiBNNzIuMjUsMzRoMTUwLjE2N3YxMzAuMzMzYzAsOS4zNSw3LjY1LDE3LDE3LDE3aDEzMy4xNjd2MjI5LjVINzIuMjVWMzR6ICAgICIgZmlsbD0iIzAwMDAwMCIvPgoJPC9nPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=);
    }

    .easyPrintHolder .A4Landscape {
        transform: rotate(-90deg);
    }

    .leaflet-control-easyPrint-button {
        display: inline-block;
    }

    .easyPrintHolder {
        margin-top: -31px;
        margin-bottom: -5px;
        margin-left: 30px;
        padding-left: 0px;
        display: none;
    }

    .easyPrintSizeMode {
        display: inline-block;
    }

    .easyPrintHolder .easyPrintSizeMode a {
        border-radius: 0px;
    }

    .easyPrintHolder .easyPrintSizeMode:last-child a {
        border-top-right-radius: 2px;
        border-bottom-right-radius: 2px;
        margin-left: -1px;
    }

    .easyPrintPortrait:hover, .easyPrintLandscape:hover {
        background-color: #757570;
        cursor: pointer;
    }

    .leaflet-touch .leaflet-bar a {
        width: 30px;
        height: 30px;
        line-height: 30px;
    }

    .upload_item {
        display: inline-block;
        margin: 10px 20px 10px 10px;
        position: relative;
    }

        .upload_item .thumbnail {
            height: 96px;
        }

        .upload_item i.btnDeletefile, .upload_item i.btnDeleteCloseJobfile {
            position: absolute;
            top: -5px;
            right: -5px;
            border-radius: 50%;
            background: #fff;
            padding: 4px;
            font-size: 1.2rem;
            border: solid 1px #000;
        }

</style>




<script src="~/Scripts/html2canvas.min.js"></script>

<script>

    var addUrl = '@Url.Action("SaveRepaireWork", "Complaint")';
    var itemUrl = getBaseUrl() + 'api/Item/';
    var sysRequestTypes = @Html.Raw(Json.Encode(sysRequestTypes));
    var SysRequestCategorys = @Html.Raw(Json.Encode(SysRequestCategorys));
    var SysRequestCategorySubjects = @Html.Raw(Json.Encode(SysRequestCategorySubjects));
    var SysItems =@Html.Raw(Json.Encode(SysItems));
    var SysUnit =@Html.Raw(Json.Encode(SysUnit));
    var IncidentList = @Html.Raw(Json.Encode(incidentList));
        var model = @Html.Raw(Json.Encode(Model));
</script>
<div class="row" data-plugin="matchHeight" data-by-row="true">
    <div class="col-xxl-12">


        <!-- Contacts Content -->
        <div class="panel panel-primary panel-line">

            <!-- Contacts Content Header -->
            <div class="panel-heading">
                <h1 class="panel-title">รายการแจ้งซ่อม > เพิ่ม/แก้ไข </h1>
                <div class="page-header-actions">

                </div>
            </div>

            <!-- Contacts Content -->
            <div class="panel-body" data-plugin="selectable">

                <!-- Actions -->
                <div class="page-content-actions">
                    <div class="row">
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group ">
                                <label for="RWCode">หมายเลขงาน</label>
                                <input type="text" class="form-control " disabled id="RWCode" value="@(Model !=null  ? Model.RWCode.ToString() :"")" placeholder="หมายเลขงาน" />
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <label for="WorkingDate">วันที่รับงาน</label>
                                <div class="input-group">

                                    <input type="text" class="form-control datetime"
                                           id="WorkingDate"
                                           value="@(Model !=null  && Model.WorkingDate!="" ? Model.WorkingDate.ToString() :Converting.DateOfdd_MM_yyyyTH(DateTime.Now))"
                                           placeholder="วันที่รับงาน" data-plugin="datepicker">
                                    <span class="input-group-addon ">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-2 col-lg-2">
                            <div class="form-group">
                                <label for="WorkingTime">เวลา</label>
                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                    <input type="text" class="form-control" placeholder="เวลา"
                                           id="WorkingTime"
                                           value="@(Model !=null && Model.WorkingTime!=""  ? Model.WorkingTime : Converting.DateOfHHmmTH(DateTime.Now))">

                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 col-lg-2">
                            <div class="form-group">
                                <label for="ddlAccountId">เจ้าหน้าที่</label>
                                <select class="ddlAccountId"
                                        id="ddlAccountId"
                                        tabindex="-98">
                                    <option value="0">เจ้าหน้าที่</option>
                                    @foreach (DropDownlistDto it in Employees)
                                    {
                                        <option value="@it.Value" @(it.Value.Trim() == (currentUser.UserLogin) ? "selected" : "")>@it.Text </option>
                                    }

                                </select>

                            </div>
                        </div>
                        <div class="col-md-2 col-lg-2">
                            <div class="form-group  disabled">
                                <label for="Status">สถานะ</label>
                                <select class="Status disabled"
                                        id="Status"
                                        value="@(Model !=null  ? Model.Status :"")">
                                    <option value="0" @(Model != null && Model.Status == "0" ? "selected" : "")>สถานะ</option>
                                    <option value="5" @(Model != null && Model.Status == "5" ? "selected" : "")>ตรวจสอบ</option>
                                    <option value="6" @(Model != null && Model.Status == "6" ? "selected" : "")>เตรียมงานซ่อม</option>
                                    <option value="7" @(Model != null && Model.Status == "7" ? "selected" : "")>อยู่ระหว่างซ่อม</option>
                                    <option value="8" @(Model != null && Model.Status == "8" ? "selected" : "")>ซ่อมเสร็จแล้ว</option>
                                    <option value="9" @(Model != null && Model.Status == "9" ? "selected" : "")>รอหัวหน้าอนุมัติ</option>
                                    <option value="10" @(Model != null && Model.Status == "10" ? "selected" : "")>
                                        ดำเนินการแล้วเสร็จ
                                    </option>

                                </select>

                            </div>


                        </div>


                    </div>
                    <div class="row">

                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <label for="NotificationDate">วันที่แจ้ง</label>
                                <div class="input-group">

                                    <input type="text" class="form-control datetime" placeholder="วันที่แจ้ง"
                                           id="NotificationDate"
                                           value="@(Model !=null  && Model.NotificationDate!="" ? Model.NotificationDate :Converting.DateOfdd_MM_yyyyTH(DateTime.Now))"
                                           data-plugin="datepicker">
                                    <span class="input-group-addon ">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-2 col-lg-2">
                            <div class="form-group">
                                <label for="WorkingDate">เวลา</label>
                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                    <input type="text" class="form-control" placeholder="เวลา"
                                           id="NotificationTime"
                                           value="@(Model !=null && Model.NotificationTime!=""  ? Model.NotificationTime :Converting.DateOfHHmmTH(DateTime.Now))">

                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 col-lg-2">
                            <div class="form-group" style="padding-top:40px">

                                <input type="checkbox" class="icheckbox-primary" id="chkSLA"
                                       name="inputiCheckCheckboxes"
                                       @(Model != null && Model.SLA == "1" ? "checked" : "")
                                       data-checkbox-class="icheckbox_flat-blue" />
                                <label for="inputUnchecked">ยกเว้นSLA</label>
                            </div>

                        </div>
                        <div class="col-md-5 col-lg-5">
                            <div class="form-group">
                                <label for="" class="lblSlaDetail" id="lblSlaDetail">เหตุผล</label>
                                <select id="ddlSlaDetail" class="select2" v-model="incident.SlaDetail">
                                    <option value="0">กรุณาเลือก</option>

                                    @foreach (DropDownlistDto it in ViewBag.Reasons)
                                    {
                                        <option value="@it.Value" @(it.Value == (Model != null ? Model.Reason : "") ? "selected" : "")>@it.Text </option>
                                    }
                                </select>
                            </div>
                        </div>


                    </div>

                    <div class="row">
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <label for="ddlRequestType" class="lbRequestType">ประเภทรับแจ้ง</label>
                                <select class="ddlRequestType"
                                        id="ddlRequestType"
                                        tabindex="-98">
                                    <option value="0">กรุณาเลือก</option>
                                    @foreach (DropDownlistDto it in sysRequestTypes)
                                    {
                                        <option value="@it.Value" @(it.Value == (Model != null ? Model.RequestType : (incidentList != null && incidentList.Count > 0 ? incidentList[0].PwaIncidentTypeID : "")) ? "selected" : "")>@it.Text </option>
                                    }

                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <label for="ddlRequestCategory" class="lbRequestCategory">ด้านการร้องเรียน</label>
                                <select class="ddlRequestCategory"
                                        id="ddlRequestCategory">
                                    <option value="0">กรุณาเลือก</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6">
                            <div class="form-group">
                                <label for="ddlRequestCategorySubject" class="lbRequestCategorySubject">หัวข้อการร้องเรียน</label>
                                <select class="ddlRequestCategorySubject"
                                        id="ddlRequestCategorySubject">
                                    <option value="0">กรุณาเลือก</option>
                                </select>
                            </div>
                        </div>


                    </div>
                    <div class="row">
                        <!--        <div class="col-md-4 col-lg-4">
        <select data-plugin="selectpicker" class="selectpicker" id="ddlArea">
            <option>เลือกเขต</option>


        </select>
    </div>-->
                        <div class="col-md-4 col-lg-4 " style="position:absolute;display:none" >
                            <div class="form-group">
                                <label for="ddlBranch">สาขา</label>
                                <select class="ddlBranch">
                                    <option value="0">เลือกสาขา</option>
                                    @foreach (DropDownlistDto it in SysBranch)
                                    {
                                        <option value="@it.Value" @(it.Value == (Model != null && Model.BranchId != null ? Model.BranchId
                                                                                              :(incidentList!=null && incidentList.Count > 0  ?incidentList[0].BranchNo : currentUser.Ba)) ? "selected" : "")>@it.Text </option>
                                    }

                                </select>
                            </div>
                        </div>

                   
                    </div>
                        </div>
                <div class="row">

                    <div class="col-md-6 col-lg-6">
                        <div style="padding-top:10px;">
                            <button type="button" class="btn  btn-success btnAddRepaire invisible">เพิ่มการแจ้ง</button>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6">
                        <div style="padding-top:10px;" >
                            @if (Model != null && Model.Effect != null)
                            {
                            <button type="button" class="btn  btn-warning btnRepaireHistory pull-right">ประวัติซ่อม</button>
                            }
                        </div>
                    </div>
                </div>

                    <div class="row" style="padding-top:10px">
                        <div class="col-md-12 col-lg-12">

                            <div class="card border">

                                <div class="table-responsive">
                                    <table class="table table-striped" data-animate="fade" id="tblDisplay">
                                        <thead>
                                            <tr>
                                                <th class="pre-cell"></th>
                                                <th class="cell-30" scope="col">

                                                </th>


                                                <th class="" scope="col">วันเวลาที่รับแจ้ง</th>
                                                <th class="" scope="col">เลขที่รับแจ้ง</th>
                                                <th class="" scope="col">หัวข้อ</th>
                                                <th scope="col" class="">รายละเอียดเรื่องรับแจ้ง</th>
                                                <th class="" scope="col">สถานที่</th>


                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (incidentList != null)
                                            {
                                                foreach (var data in incidentList)
                                                {
                                                    <tr data-url="panel.tpl" data="@data.PwaIncidentID">
                                                        <td class="pre-cell"></td>
                                                        <td class="cell-30">
                                                            <span class="checkbox-custom checkbox-primary checkbox-lg">
                                                                <input type="checkbox" class="contacts-checkbox chkItem" />
                                                                <label for="contacts_1"></label>
                                                            </span>
                                                        </td>
                                                        <td class="">@data.CreatedDate.ToString("dd/MM/yyyy")</td>
                                                        <td class="">@data.PwaIncidentNo</td>
                                                        <td class="">@data.RequestCategorySubject</td>
                                                        <td class="">@data.CaseDetail</td>
                                                        <td class="">@data.PwsIncidentAddress</td>



                                                    </tr>

                                                }
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>

                    @if (Model != null)
                    {
                        <input type="hidden" id="hddTab1SurveyId" value="@(Model !=null && Model.Survey!=null ? Model.Survey.SurveyId :"")" />
                        <input type="hidden" id="hddTab2EffectId" value="@(Model !=null && Model.Effect!=null ? Model.Effect.EffectId :"")" />
                        <input type="hidden" id="hddTab3OpenCaseId" value="@(Model !=null && Model.OpenCase!=null ? Model.OpenCase.OpenCaseId :"")" />
                        <input type="hidden" id="hddTab4ProcessId" value="@(Model !=null && Model.Process!=null ? Model.Process.ProcessId :"")" />
                        <input type="hidden" id="hddTab5CloseJobId" value="@(Model !=null && Model.CloseJob!=null ? Model.CloseJob.CloseJobId :"")"
                        <div class="row" style="padding-top:10px">
                            <div class="col-md-12 col-lg-12">

                                <ul class="nav nav-tabs nav-tabs-line">

                                    <li class="nav-item"><a class="nav-link @( Converting.ToInt(Model.Status)==5 ? "active" : "")" Status="5" data-toggle="tab" href="#menu1">สำรวจพื้นที่ และ ประเมินผลกระทบ</a></li>
                                            <li class="nav-item"><a class="nav-link @( Converting.ToInt(Model.Status)==6 ? "active" : "")"  Status="6"  data-toggle="tab" href="#menu3">เปิดงานซ่อม</a></li>
                                        <li class="nav-item"><a class="nav-link @( Converting.ToInt(Model.Status)==7 ? "active" : "")" Status="7"  data-toggle="tab" href="#menu4">ดำเนินการซ่อมภาคสนาม</a></li>
                                    @if (Model != null && Model.Process != null && Converting.ToInt(Model.Status) >=8)
                                    {
                                        <li class="nav-item"><a class="nav-link @( Converting.ToInt(Model.Status)>=8 ? "active" : "")"  Status="8"  data-toggle="tab" href="#menu5">ปิดงานซ่อม</a></li>
                                    }
                                </ul>
                                <div class="tab-content">
                                    <!--Tab 1 สำรวจพื้นที่ -->

                                    @if (Model != null)
                                    {
                                        <div id="menu1" class="tab-pane fade @( Converting.ToInt(Model.Status)==5 ? "in active" : "")">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <div class="panel-title"></div>
                                                </div>
                                                <div class="panel-body">



                                                    <div class="row">
                                                        <div class="col-md-12 col-lg-12">
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <div class="panel2-title">รายละเอียด</div>

                                                                </div>
                                                                <div class="panel2-body" style="padding:10px;">
                                                                    <div class="row">
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="SurveyDate">วันที่สำรวจ</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime"
                                                                                           id="SurveyDate"
                                                                                           value="@(Model != null && Model.Survey != null  && Model.Survey.SurveyDate!=null && Model.Survey.SurveyDate!="" ? Model.Survey.SurveyDate : Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           placeholder="วันที่สำรวจ" data-plugin="datepicker">
                                                                                    <span class="input-group-addon ">
                                                                                        <span class="glyphicon glyphicon-calendar"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="SurveyTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           id="SurveyTime"
                                                                                           value="@(Model != null && Model.Survey != null ? Model.Survey.SurveyTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2" style="top:34px">
                                                                            <div class="form-group">
                                                                          
                                                                                <input type="checkbox" class="icheckbox-primary" id="IsBroken" name="IsBroken"
                                                                                       @(Model != null && Model.Survey != null && Model.Survey.IsBroken == "1" ? "checked" : "") />
                                                                                <label for="IsBroken">ท่อแตกรั่ว</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-5 col-lg-5">
                                                                            <div class="form-group">
                                                                                <label for="ddlSurveyAccountId">ผู้สำรวจ</label>
                                                                                <select class=" ddlSurveyAccountId"
                                                                                        id="ddlSurveyAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ผู้สำรวจ...</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Survey != null && Model.Survey.SurveyAccountId != null && Model.Survey.SurveyAccountId != "" ? Model.Survey.SurveyAccountId.Trim() : (currentUser.UserLogin)) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>

                                                                    </div>
                                                                    <div class="row" style="padding-bottom:10px;">

                                                                        <div class="col-md-4 col-lg-4">
                                                                            <div class="form-group">
                                                                                <label for="BrokenAppearance">ลักษณะการแตก-รั่วท่อ</label>
                                                                                <input type="text" class="form-control"
                                                                                       id="BrokenAppearance"
                                                                                       value="@(Model != null && Model.Survey != null ? Model.Survey.BrokenAppearance : "")"
                                                                                       placeholder="ลักษณะการแตก-รั่วท่อ" />

                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="PiplineType">ชนิดของท่อ</label>
                                                                                <select class=" PiplineType"
                                                                                        id="PiplineType">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysGISPIPETYPE)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Survey != null && Model.Survey.PiplineType != null ? Model.Survey.PiplineType.Trim() : "") ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="PiplineSize">ขนาดของท่อ</label>
                                                                                <select class=" PiplineSize"
                                                                                        id="PiplineSize">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysPipelineSize)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Survey != null && Model.Survey.PiplineSize != null ? Model.Survey.PiplineSize.Trim() : "") ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-4 col-lg-4">
                                                                            <div class="form-group">
                                                                                <label for="SurfaceAppearance">ลักษณะพื้นผิว</label>
                                                                                <select class=" SurfaceAppearance"
                                                                                        id="SurfaceAppearance">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysSurface)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Survey != null && Model.Survey.SurfaceAppearance != null ? Model.Survey.SurfaceAppearance.Trim() : "") ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-6">
                                                                            <label for="SurveyReason">สาเหตุที่เกิดเหตุ</label>
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control"
                                                                                       id="SurveyReason"
                                                                                       value="@(Model != null && Model.Survey != null ? Model.Survey.Reason : "")"
                                                                                       placeholder="สาเหตุที่เกิดเหตุ" />

                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6 col-lg-6">
                                                                            <label for="SurveyLocation">สถานที่เกิดเหตุ</label>
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control"
                                                                                       id="SurveyLocation"
                                                                                       value="@(Model != null && Model.Survey != null ? Model.Survey.Location : "")"
                                                                                       placeholder="สถานที่เกิดเหตุ" />

                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                      


                                                        <div class="row">
                                                            <div class="col-md-4">
                                                                <div class="divSurveyToolSection">
                                                                    <div class="divSurveyTool">
                                                                        <div class="panel2">
                                                                            <div class="panel2-header">
                                                                                <label class="panel2-title">สร้าง/เลือกข้อมุล</label>
                                                                            </div>
                                                                            <div class="panel2-body">
                                                                                <div class="row">
                                                                                    <div class="col-sm-12">
                                                                                        <div class="form-group ddlToolType">
                                                                                            <label for="ddlToolType">จุดงานซ่อม</label>
                                                                                            <select id="ddlToolType">
                                                                                                <option value="0">กรุณาเลือก</option>
                                                                                                <option value="4" @((Model != null && Model.Effect != null ? Model.Effect.ToolType : "") == "4" ? "selected" : "")>ไม่ระบุ</option>
                                                                                                <option value="1" @((Model != null && Model.Effect != null ? Model.Effect.ToolType : "") == "1" ? "selected" : "")>Buffer</option>
                                                                                                <option value="2" @((Model != null && Model.Effect != null ? Model.Effect.ToolType : "") == "2" ? "selected" : "")> ให้ผู้ใช้วาด Boundary เป็น Polygon</option>
                                                                                                <option value="3" @((Model != null && Model.Effect != null ? Model.Effect.ToolType : "") == "3" ? "selected" : "")>หาความสัมพันธ์ระหว่างท่อและมิเตอร์น้ำ โดยในมิเตอร์จะเก็บ ID ท่อ </option>
                                                                                            </select>

                                                                                        </div>

                                                                                    </div>
                                                                                    <div class="col-sm-12">
                                                                                        <div class="divBuffer">
                                                                                            <div class="form-group">
                                                                                                <label for="txtBuffer">*รัศมี(เมตร)</label>
                                                                                                <select id="txtBuffer">

                                                                                                    @for (int i = 0; i <= 30; i++)
                                                                                                    {
                                                                                                        <option value="@i" @((Model != null && Model.Effect != null ? Model.Effect.Buffer : "") == i.ToString() ? "selected" : "")>@i.ToString()</option>
                                                                                                    }
                                                                                                </select>

                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-xl-12" align="center">
                                                                                        <div class=" form-group">
                                                                                            <!-- <button class="btn btn-outline-primary btnDownload">Download</button>-->
                                                                                            <button class="btn btn-outline-primary btnEffect">ตกลง</button>
                                                                                            <button class="btn btn-outline-default">ยกเลิก</button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-sm-12">
                                                                                <div class="panel2">
                                                                                    <div class="panel2-header">
                                                                                        <label class="panel2-title">สรุปผู้ใช้น้ำที่ได้รับผลกระทบ</label>
                                                                                    </div>
                                                                                    <div class="panel2-body">
                                                                                        <div class="table-responsive divCustEffect">
                                                                                            <table class="table   table-hover">
                                                                                                <thead>
                                                                                                    <tr>
                                                                                                        <th class="cell-300" scope="col">ชื่อ</th>
                                                                                                        <th scope="col" class="cell-300">เบอร์โทร</th>
                                                                                                        <th scope="col" class="cell-300">ที่อยู่</th>

                                                                                                    </tr>
                                                                                                </thead>
                                                                                                <tbody></tbody>
                                                                                            </table>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="panel2">
                                                                            <div class="panel2-header">
                                                                                <label class="panel2-title">พื้นที่ที่ได้รับผลกระทบ</label>

                                                                            </div>
                                                                            <div class="panel-body">
                                                                                <div class="row">
                                                                                    <div class="col-sm-12">

                                                                                        <div class="table-responsive divAddrEffect">
                                                                                            <table class="table  table-hover">
                                                                                                <thead>
                                                                                                    <tr>
                                                                                                        <th class="cell-300" scope="col">ตำบล</th>
                                                                                                        <th class="cell-300" scope="col">อำเภอ</th>
                                                                                                        <th class="cell-300" scope="col">จังหวัด</th>

                                                                                                    </tr>
                                                                                                </thead>
                                                                                                <tbody>
                                                                                                    <tr>
                                                                                                        <td></td>
                                                                                                    </tr>

                                                                                                </tbody>
                                                                                            </table>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-8"><div id="previewImage"></div>
                                                                <div class="mapsection">
                                                                    <div class="divBranchMap">
                                                                        <select class="ddlBranchSearch">
                                                                            <option value="0">เลือกสาขา</option>
                                                                            @foreach (DropDownlistDto it in SysBranch)
                                                                            {
                                                                                <option value="@it.Value" @(it.Value == (Model.BranchId != null ? Model.BranchId : currentUser.Ba) ? "selected" : "")>@it.Text </option>
                                                                            }

                                                                        </select>
                                                                    </div>
                                                                    <div id="mapid" class="mapdefault"></div>
                                                                    <div class="divSurveyToolSectionMap"></div>
                                                                    <button class="btn  btn-outline-success btnExpandMap">Full Map</button>
                                                                    <button class="btn btn-outline-default btnStreetView"></button>
                                                                    <div id="streetPanorama" class="streetPanorama hidden"></div>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                    </div>
                                        </div>
                                    }
                                 

                                    <!--Tab 3 เปิดงานซ่อม -->
                
                                        <div id="menu3" class="tab-pane fade @( Converting.ToInt(Model.Status)==6 ? "in active" : "")">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <div class="panel-title"></div>
                                                </div>
                                                <div class="panel-body">
                                                    <div class="row" style="padding-bottom:10px;">
                                                        <div class="col-md-12 col-lg-12">
                                                            <div class="form-group">

                                                                @if (Model != null && Model.OpenCase != null)
                                                                {
                                                                    <a class="btn btn-outline btn-info pull-right"
                                                                       href="@Url.Action("PDFOpenRepair", "Pdf", new { id =Model.RWId})"
                                                                       target="_blank">พิมพ์ใบเปิดงานซ่อม</a>
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <div class="panel2-title">รายละเอียด</div>

                                                                </div>
                                                                <div class="panel2-body" style="padding:10px;">
                                                                    <div class="row">
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <input type="checkbox" class="icheckbox-primary"
                                                                                       @(Model != null && Model.OpenCase != null && Model.OpenCase.IsUrgent == "1" ? "checked" : "")
                                                                                       id="Tab3IsUrgent" />
                                                                                <label for="Tab3IsUrgent">ซ่อมด่วน</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <input type="checkbox" class="icheckbox-primary"
                                                                                       @(Model != null && Model.OpenCase != null && Model.OpenCase.IsOutSource == "1" ? "checked" : "")
                                                                                       id="Tab3IsOutSource" />
                                                                                <label for="Tab3IsOutSource">จ้างเหมาซ่อมท่อ</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3OpenDate">วันที่เปิดงาน</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime"
                                                                                           placeholder="วันที่เปิดงาน"
                                                                                           value="@(Model != null
                                                                             && Model.OpenCase != null
                                                                             &&  Model.OpenCase.OpenDate!=null
                                                                             &&  Model.OpenCase.OpenDate!=""? Model.OpenCase.OpenDate : Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           id="Tab3OpenDate"
                                                                                           data-plugin="datepicker">
                                                                                    <span class="input-group-addon ">
                                                                                        <span class="glyphicon glyphicon-calendar"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab3OpenTime">เวลา</label>
                                                                                <div class="input-group clockpicker"
                                                                                     data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           value="@(Model != null && Model.OpenCase != null
                                                                          && Model.OpenCase.OpenTime != null
                                                                          && Model.OpenCase.OpenTime != ""? Model.OpenCase.OpenTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           id="Tab3OpenTime" placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3OpenAccountId">ผู้เปิดงานซ่อม</label>
                                                                                <select class=" Tab3OpenAccountId "
                                                                                        id="Tab3OpenAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ผู้เปิดงานซ่อม</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null && Model.OpenCase.OpenAccountId != null ? Model.OpenCase.OpenAccountId.Trim() : (Model != null && Model.Survey != null && Model.Survey.SurveyAccountId != null && Model.Survey.SurveyAccountId != "" ? Model.Survey.SurveyAccountId.Trim() : (currentUser.UserLogin))) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-6 col-lg-6">
                                                                            <div class="form-group">
                                                                                <label for="Tab3SuperAccountId" id="lblTab3SuperAccountId">หัวหน้าชุดควบคุมงานซ่อม</label>
                                                                                <select class=" Tab3SuperAccountId"
                                                                                        id="Tab3SuperAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">หัวหน้าชุดควบคุมงานซ่อม.</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null ? Model.OpenCase.SuperAccountId.Trim() : "") ? "selected" : "")>@it.Text </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-6 col-lg-6">
                                                                            <div class="form-group">
                                                                                <label for="Tab3TeamId">ทีม</label>
                                                                                <select class=" Tab3TeamId"
                                                                                        id="Tab3TeamId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ทีม...</option>
                                                                                    @foreach (DropDownlistDto it in SysTeam)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null && Model.OpenCase.TeamId != null ? Model.OpenCase.TeamId.Trim() : "") ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12 col-lg-12">
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <div class="panel2-title">ผลการตรวจสภาพพื้นผิว</div>

                                                                </div>
                                                                <div class="panel2-body" style="padding:10px;">

                                                                    <div class="row">
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <input type="checkbox" class="icheckbox-primary"
                                                                                       @(Model != null && Model.OpenCase != null && Model.OpenCase.IsBroken == "1" ? "checked" : (Model != null && Model.Survey != null && Model.Survey.IsBroken == "1" ? "checked" : ""))
                                                                                       id="Tab3IsBroken" />
                                                                                <label for="inputUnchecked">ท่อแตกรั่ว</label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3SurveyDate">วันที่สำรวจ</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime"
                                                                                           placeholder="วันที่สำรวจ"
                                                                                           value="@(Model != null && Model.OpenCase != null
                                                         && Model.OpenCase.SurveyDate!=null && Model.OpenCase.SurveyDate!="" ? Model.OpenCase.SurveyDate : Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           id="Tab3SurveyDate"
                                                                                           data-plugin="datepicker">
                                                                                    <span class="input-group-addon ">
                                                                                        <span class="glyphicon glyphicon-calendar"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab3SurveyDate">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           value="@(Model != null && Model.OpenCase != null  && Model.OpenCase.SurveyTime!= null && Model.OpenCase.SurveyTime!="" ? Model.OpenCase.SurveyTime : Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           id="Tab3SurveyTime"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-5 col-lg-5">
                                                                            <div class="form-group">
                                                                                <label for="Tab3SurveyAccountId">ผู้สำรวจ</label>
                                                                                <select class="Tab3SurveyAccountId"
                                                                                        id="Tab3SurveyAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ผู้สำรวจ...</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null ? Model.OpenCase.SurveyAccountId.Trim() : (Model != null && Model.Survey != null && Model.Survey.SurveyAccountId != null && Model.Survey.SurveyAccountId != "" ? Model.Survey.SurveyAccountId.Trim() : (currentUser.UserLogin))) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3SuperAccountId">ลักษณะการแตก-รั่วท่อ</label>
                                                                                <input type="text" class="form-control "
                                                                                       value="@(Model != null && Model.OpenCase != null
                                                                                                   && Model.OpenCase.BrokenAppearance!=null
                                                                                                   && Model.OpenCase.BrokenAppearance!="" ?
                                                                                                   Model.OpenCase.BrokenAppearance
                                                                                                   : (Model.Survey != null ? Model.Survey.BrokenAppearance : ""))"
                                                                                       id="Tab3BrokenAppearance"
                                                                                       placeholder="ลักษณะการแตก-รั่วท่อ">
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3PiplineType">ชนิดของท่อ</label>
                                                                                <select class=" Tab3PiplineType"
                                                                                        id="Tab3PiplineType">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysGISPIPETYPE)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null && Model.OpenCase.PiplineType != null && Model.OpenCase.PiplineType != ""  && Model.OpenCase.PiplineType != "0"? Model.OpenCase.PiplineType : (Model.Survey != null ? Model.Survey.PiplineType : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3PiplineSize">ขนาดของท่อ</label>
                                                                                <select class=" Tab3PiplineSize"
                                                                                        id="Tab3PiplineSize">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysPipelineSize)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null && Model.OpenCase.PiplineSize != null && Model.OpenCase.PiplineSize != "" && Model.OpenCase.PiplineSize != "0"  ? Model.OpenCase.PiplineSize : (Model.Survey != null ? Model.Survey.PiplineSize : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>

                                                                        </div>

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab3SurfaceAppearance">ลักษณะพื้นผิว</label>

                                                                                <select class=" Tab3SurfaceAppearance"
                                                                                        id="Tab3SurfaceAppearance">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysSurface)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.OpenCase != null && Model.OpenCase.SurfaceAppearance != null && Model.OpenCase.SurfaceAppearance != "" ? Model.OpenCase.SurfaceAppearance : (Model.Survey != null ? Model.Survey.SurfaceAppearance : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-12 col-lg-12">
                                                                            <div class="form-group">
                                                                                <label for="Tab3Location">สถานที่เกิดเหตุ</label>
                                                                                <input type="text" class="form-control"
                                                                                       value="@(Model != null && Model.OpenCase != null
                                                                                                   && Model.OpenCase.Location!=null
                                                                                                   && Model.OpenCase.Location!="" ?
                                                            Model.OpenCase.Location
                                                            : ( Model.Survey !=null &&  Model.Survey.Location!=null ? Model.Survey.Location : "" ))"
                                                                                       id="Tab3Location"
                                                                                       placeholder="สถานที่เกิดเหตุ">
                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-12 col-lg-12">
                                                                            <div class="form-group">
                                                                                <label for="Tab3Location">หมายเหตุ</label>
                                                                                <textarea type="text" class="form-control marker"
                                                                                          value="@(Model != null && Model.OpenCase != null ? Model.OpenCase.Comment : "")"
                                                                                          id="Tab3Comment"
                                                                                          placeholder="หมายเหตุ"> @(Model != null && Model.OpenCase != null ? Model.OpenCase.Comment : "") </textarea>
                                                                            </div>

                                                                        </div>
                                                                    </div>


                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-12">

                                                            <div class="row">
                                                                <div class="col-md-4 col-lg-4">
                                                                    <div class="form-group ">
                                                                        <label>เบิกวัสดุอุปกรณ์ที่ใช้</label> <button type="button" class="btn btn-floating btn-success btn-sm btnAddNewItem"><i class="icon wb-plus" aria-hidden="true"></i></button>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-7 col-lg-7">
                                                                    <div class="form-group">
                                                                        <div class="divOpenCase_Template">
                                                                            <div class="divTemplate">
                                                                                <select class=" Tab3SysItemSetID select2"
                                                                                        id="Tab3SysItemSetID">
                                                                                    <option value="0">เลือก Template</option>
                                                                                    @foreach (SysItem_SetDto it in ViewBag.SysItem_Set)
                                                                                    {
                                                                                        <option value="@it.SetID" @(it.SetID.Trim() == (Model != null && Model.OpenCase != null && Model.OpenCase.SysItemSetID != null ? Model.OpenCase.SysItemSetID.Trim() : "") ? "selected" : "")>@it.SetName </option>
                                                                                    }

                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-12">
                                                                    <div class="table-responsive divOpenCase">
                                                                        @if (Model != null && Model.Process == null)
                                                                        {
                                                                            <div class="row">
                                                                                <div class="col-sm-12">
                                                                                    <div class="table-responsive divCloseJob">
                                                                                        <div class="divItem">
                                                                                            <table class="table tbItem" data-plugin="animateList" data-animate="fade" data-child="tr"
                                                                                                   data-selectable="selectable">
                                                                                                <thead>
                                                                                                    <tr>


                                                                                                        <th class="" scope="col"></th>

                                                                                                        <th scope="col" class="cell-200">รายการ</th>
                                                                                                        <th class="cell-120" scope="col">หน่วยนับ</th>
                                                                                                        <th scope="col" class="">จำนวน</th>
                                                                                                        <th scope="col" class="">ราคาต่อหน่วย</th>
                                                                                                        <th scope="col" class="cell-80">ราคารวม</th>
                                                                                                        <th scope="col" class=""></th>

                                                                                                    </tr>
                                                                                                </thead>
                                                                                                <tbody>

                                                                                                    @if (Model != null && Model.Items != null)
                                                                                                    {
                                                                                                        foreach (PwaRepaireWork_ItemDto item in Model.Items)
                                                                                                        {

                                                                                                            <tr>

                                                                                                                <td class=""><label class="lbNo">@item.No</label></td>
                                                                                                                <td>

                                                                                                                    <select class="form-control  selItem ">

                                                                                                                        <option value="0">กรุณาเลือก</option>
                                                                                                                        @foreach (DropDownlistDto it in SysItems)
                                                                                                                        {
                                                                                                                            <option value="@it.Value" @(item.ItemId == it.Value ? "Selected" : "")>@it.Text </option>
                                                                                                                        }
                                                                                                                    </select>


                                                                                                                </td>
                                                                                                                <td class="">
                                                                                                                    <select class="form-control selUnit ">
                                                                                                                        <option value="0">กรุณาเลือก</option>
                                                                                                                        @foreach (DropDownlistDto it in SysUnit)
                                                                                                                        {
                                                                                                                            <option value="@it.Value" @(item.UnitId == it.Value ? "Selected" : "")>@it.Text </option>
                                                                                                                        }
                                                                                                                    </select>
                                                                                                                </td>
                                                                                                                <td class=""><input type="text" onkeypress="return isNumber(event)" value="@item.Qty" class="form-control txtQty" /></td>
                                                                                                                <td class=""><input type="text" onkeypress="return isNumber(event)" value="@item.Price" class="form-control txtPrice" /></td>
                                                                                                                <td class=""><label class="lbTotal">@item.Total</label></td>
                                                                                                                <td>   <button type="button" class="btn btn-floating btn-danger btn-sm btnDeleteItem"><i class="icon wb-close" aria-hidden="true"></i></button></td>
                                                                                                            </tr>
                                                                                                        }
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        <tr>

                                                                                                            <td class="">
                                                                                                                <label class="lbNo">1</label>
                                                                                                            </td>
                                                                                                            <td>

                                                                                                                <select class="form-control  selItem">

                                                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                                                    @foreach (DropDownlistDto it in SysItems)
                                                                                                                    {
                                                                                                                        <option value="@it.Value"> @it.Text </option>
                                                                                                                    }
                                                                                                                </select>


                                                                                                            </td>
                                                                                                            <td class="">
                                                                                                                <select class="form-control selUnit ">
                                                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                                                    @foreach (DropDownlistDto it in SysUnit)
                                                                                                                    {
                                                                                                                        <option value="@it.Value"> @it.Text </option>
                                                                                                                    }
                                                                                                                </select>
                                                                                                            </td>
                                                                                                            <td class=""><input type="text" onkeypress="return isNumber(event)" class="form-control txtQty" /></td>
                                                                                                            <td class=""><input type="text" onkeypress="return isNumber(event)" class="form-control txtPrice" /></td>
                                                                                                            <td class=""><label class="lbTotal">0.00</label></td>
                                                                                                            <td>   <button type="button" class="btn btn-floating btn-danger btn-sm btnDeleteItem"><i class="icon wb-close" aria-hidden="true"></i></button></td>
                                                                                                        </tr>
                                                                                                    }



                                                                                                </tbody>
                                                                                                <tfoot>
                                                                                                    <tr class="bg-secondary">
                                                                                                        <td colspan="5" class=""> <h3 class="text-success ">รวม</h3></td>
                                                                                                        <td>
                                                                                                            <h3 class=" text-success lblSummary">
                                                                                                                @((Model != null && Model.Items != null) ? Model.Items.Sum(o => Converting.ToDoble(o.Total)).ToString("##,##0.00") : "0.00")

                                                                                                            </h3>

                                                                                                        </td>
                                                                                                        <td></td>

                                                                                                    </tr>

                                                                                                </tfoot>
                                                                                            </table>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                                    </div>
                                                </div>
                  
                                    <!--Tab 4 ดำเนินการซ่อมภาคสนาม -->
 
                                        <div id="menu4" class="tab-pane fade @( Converting.ToInt(Model.Status)==7 ? "in active" : "")">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <div class="panel-title"></div>
                                                </div>
                                                <div class="panel-body">
                                                    <div class="row">
                                                        <div class="col-md-12 col-lg-12">
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <div class="panel2-title">รายละเอียด</div>

                                                                </div>
                                                                <div class="panel2-body" style="padding:10px;">
                                                                    <div class="row">

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <input type="checkbox"
                                                                                       class="icheckbox-primary"
                                                                                       id="Tab4IsSuccess"
                                                                                       @(Model != null && Model.Process != null && Model.Process.IsSuccess == "1" ? "checked" : "")
                                                                                       data-checkbox-class="icheckbox_flat-blue" />
                                                                                <label for="inputUnchecked">
                                                                                    ซ่อมเสร็จเรียบร้อย
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-2 col-lg-2">

                                                                            <div class="form-group">
                                                                                <label for="Tab4FromProcessDate">วันที่ดำเนินการ</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime"
                                                                                           id="Tab4FromProcessDate"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.FromProcessDate!=null ? Model.Process.FromProcessDate :Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           placeholder="จากวันที่" data-plugin="datepicker">
                                                                                    <span class="input-group-addon ">
                                                                                        <span class="glyphicon glyphicon-calendar"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4FromProcessDate">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           id="Tab4FromProcessTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process!=null ? Model.Process.FromProcessTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4ToProcessDate">ถึงวันที่</label>
                                                                                <div class="input-group">
                                                                                    <input type="text" class="form-control datetime"
                                                                                           id="Tab4ToProcessDate"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process!=null ? Model.Process.ToProcessDate :Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           placeholder="ถึงวันที่" data-plugin="datepicker">
                                                                                    <span class="input-group-addon ">
                                                                                        <span class="glyphicon glyphicon-calendar"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4ToProcessTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           id="Tab4ToProcessTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.ToProcessTime!=null ? Model.Process.ToProcessTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4ToProcessTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           id="Tab4ToProcessTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.ToProcessTime!=null ? Model.Process.ToProcessTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4RepaireAccountId">ผู้ซ่อม</label>
                                                                                <select class=" Tab4RepaireAccountId "
                                                                                        id="Tab4RepaireAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ผู้ซ่อม</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.RepaireAccountId != null ? Model.Process.RepaireAccountId.Trim() : currentUser.UserLogin) ? "selected" : "")>@it.Text </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-3 col-lg-3">

                                                                            <div class="form-group">
                                                                                <label for="Tab4SurfaceFixedDate">วันที่ซ่อมพื้นผิว</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime" placeholder="วันที่ซ่อมพื้นผิว"
                                                                                           id="Tab4SurfaceFixedDate"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.SurfaceFixedDate!=null ? Model.Process.SurfaceFixedDate :Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           data-plugin="datepicker">
                                                                                    <span class="input-group-addon ">
                                                                                        <span class="glyphicon glyphicon-calendar"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4SurfaceFixedTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control"
                                                                                           id="Tab4SurfaceFixedTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.SurfaceFixedTime!=null ? Model.Process.SurfaceFixedTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab4SuperAccountId">จน.ผู้ควบคุมงานซ่อม</label>
                                                                                <select class=" Tab4SuperAccountId "
                                                                                        id="Tab4SuperAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">จน.ผู้ควบคุมงานซ่อม</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.SuperAccountId != null ? Model.Process.SuperAccountId.Trim() : currentUser.UserLogin) ? "selected" : "")>@it.Text </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-4 col-lg-4">
                                                                            <div class="form-group">
                                                                                <label for="Tab4TeamId">ทีม</label>
                                                                                <select class=" Tab4TeamId"
                                                                                        id="Tab4TeamId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ทีม...</option>
                                                                                    @foreach (DropDownlistDto it in SysTeam)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.TeamId != null ? Model.Process.TeamId.Trim() : "") ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab4BrokenAppearance">ลักษณะการแตกของท่อจริง</label>
                                                                                <input type="text" class="form-control"
                                                                                       id="Tab4BrokenAppearance"
                                                                                       value="@(Model !=null && Model.Process != null
                                                                             && Model.Process.BrokenAppearance!=null
                                                                             && Model.Process.BrokenAppearance!=""?
                                                                             Model.Process.BrokenAppearance
                                                                             : (Model.Survey != null
                                                                                && Model.Survey.BrokenAppearance!=null ?
                                                                                Model.Survey.BrokenAppearance : ""))"
                                                                                       placeholder="ลักษณะการแตกของท่อจริง" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4PiplineType">ชนิดของท่อ</label>
                                                                                <select class=" Tab4PiplineType"
                                                                                        id="Tab4PiplineType">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysGISPIPETYPE)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.PiplineType != null && Model.Process.PiplineType != "" && Model.Process.PiplineType != "0" ? Model.Process.PiplineType : (Model.Survey != null && Model.Survey.PiplineType != null && Model.Survey.PiplineType != "" ? Model.Survey.PiplineType : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4PiplineSize">ขนาดของท่อ</label>
                                                                                <select class=" Tab4PiplineSize"
                                                                                        id="Tab4PiplineSize">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysPipelineSize)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.PiplineSize != null && Model.Process.PiplineSize != "" && Model.Process.PiplineSize != "0" ? Model.Process.PiplineSize : (Model.Survey != null && Model.Survey.PiplineSize != null ? Model.Survey.PiplineSize : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group" style="padding-top:30px;">
                                                                                <input type="checkbox" class="icheckbox-primary"
                                                                                       @(Model != null && Model.Process != null && Model.Process.IsNotGIS == "1" ? "checked" : "")
                                                                                       id="Tab4IsNotGIS" />
                                                                                <label for="Tab4IsNotGIS">GIS ไม่ตรงกับหน้างาน</label>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4SurfaceAppearance">ลักษณะพื้นผิว</label>
                                                                                <select class=" Tab4SurfaceAppearance"
                                                                                        id="Tab4SurfaceAppearance">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysSurface)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.SurfaceAppearance != null && Model.Process.SurfaceAppearance != "" ? Model.Process.SurfaceAppearance : (Model.Survey != null && Model.Survey.SurfaceAppearance != "" ? Model.Survey.SurfaceAppearance : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>
                                                                        </div>


                                                                    </div>

                                                                    <div class="row">
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label>
                                                                                    ขนาดหลุม
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4HoleWidth">กว้าง</label>
                                                                                <input type="text" class="form-control"
                                                                                       id="Tab4HoleWidth"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.HoleWidth!=null ? Model.Process.HoleWidth :"")"
                                                                                       placeholder="กว้าง" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4HoleLength">ยาว</label>
                                                                                <input type="text" class="form-control"
                                                                                       id="Tab4HoleLength"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.HoleLength!=null ? Model.Process.HoleLength :"")"
                                                                                       placeholder="ยาว" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab4HoleDepth">ลึก</label>
                                                                                <input type="text" class="form-control"
                                                                                       id="Tab4HoleDepth"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.HoleDepth!=null ? Model.Process.HoleDepth :"")"
                                                                                       placeholder="ลึก" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-4 col-lg-4">
                                                                            <div class="form-group">
                                                                                <label for="Tab4ToolType">เครื่องมือที่ใช้</label>
                                                                                <input type="text" class="form-control"
                                                                                       id="Tab4ToolType"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.ToolType!=null ? Model.Process.ToolType :"")"
                                                                                       placeholder="เครื่องมือที่ใช้" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <input type="checkbox" class="icheckbox-primary "
                                                                                       id="Tab4IsOutSource"
                                                                                       @(Model != null && Model.Process != null && Model.Process.IsOutSource == "1" ? "checked" : "")
                                                                                       data-checkbox-class="icheckbox_flat-blue" />
                                                                                <label for="inputUnchecked">
                                                                                    จ้างเหมาซ่อมท่อ
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                            <div class="row">
                                                                <div class="col-md-12 col-lg-12">
                                                                    <div class="table-responsive">
                                                                        <table class="table  table-hover">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th width="10%">No</th>
                                                                                    <th width="40%">ขั้นตอน</th>
                                                                                    <th>ไฟล์</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr>
                                                                                    <td>1</td>
                                                                                    <td>
                                                                                        ก่อนซ่อม
                                                                                    </td>
                                                                                    <td>
                                                                                        @if (Model != null && Model.Process != null
                                                                                                                     && Model.Process.Files != null
                                                                                                                     && Model.Process.Files.Count > 0
                                                                                                                    && Model.Process.Files.Find(o => o.No == "1") != null)
                                                                                        {
                                                                                            fileDto = Model.Process.Files.Find(o => o.No == "1");
                                                                                        <div class="upload_item">
                                                                                            <label class="file-upload btn btn-info btn-outline invisible">
                                                                                                Browse for file... <input type="file" id="file1" />
                                                                                            </label>
                                                                                            <a target="_blank" href="@Url.Content(fileDto.HtmlFile)">
                                                                                                <img src="@Url.Content(fileDto.HtmlFile)"
                                                                                                     data-html="true"
                                                                                                     onerror="this.src='@Url.Content("~/Content/assets/images/icon_file.png")'"
                                                                                                     data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                                                                                     class="thumbnail" />
                                                                                                <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile vertical-align-middle" data="@fileDto.FileID"></i>
                                                                                       </a>
                                                                                                </div>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <label class="file-upload btn btn-info btn-outline">
                                                                                                Browse for file... <input type="file" id="file1" />
                                                                                            </label>

                                                                                        }
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td>2</td>
                                                                                    <td> เตรียมการก่อนซ่อม</td>
                                                                                    <td>
                                                                                        @if (Model != null && Model.Process != null
                                                                                                                     && Model.Process.Files != null
                                                                                                                     && Model.Process.Files.Count > 0
                                                                                                                    && Model.Process.Files.Find(o => o.No == "2") != null)
                                                                                        {
                                                                                            fileDto = Model.Process.Files.Find(o => o.No == "2");
                                                                                        <div class="upload_item">
                                                                                            <label class="file-upload btn btn-info btn-outline invisible">
                                                                                                Browse for file... <input type="file" id="file2" />
                                                                                            </label>
                                                                                            <a target="_blank" href="@Url.Content(fileDto.HtmlFile)">
                                                                                                <img src="@Url.Content(fileDto.HtmlFile)"
                                                                                                     data-html="true"
                                                                                                     onerror="this.src='@Url.Content("~/Content/assets/images/icon_file.png")'"
                                                                                                     data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                                                                                     class="thumbnail" />
                                                                                                <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile" data="@fileDto.FileID"></i>
                                                                                            </a>
                                                                                                </div>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <label class="file-upload btn btn-info btn-outline">
                                                                                                Browse for file... <input type="file" id="file2" />
                                                                                            </label>

                                                                                        }
                                                                                    </td>
                                                                                </tr>

                                                                                <tr>
                                                                                    <td>3</td>
                                                                                    <td>ระหว่างซ่อม</td>
                                                                                    <td>
                                                                                        @if (Model != null && Model.Process != null
                                                                                                                   && Model.Process.Files != null
                                                                                                                   && Model.Process.Files.Count > 0
                                                                                                                  && Model.Process.Files.Find(o => o.No == "3") != null)
                                                                                        {
                                                                                            fileDto = Model.Process.Files.Find(o => o.No == "3");
                                                                                        <div class="upload_item">
                                                                                            <label class="file-upload btn btn-info btn-outline invisible">
                                                                                                Browse for file... <input type="file" id="file3" />
                                                                                            </label>
                                                                                            <a target="_blank" href="@Url.Content(fileDto.HtmlFile)">
                                                                                                <img src="@Url.Content(fileDto.HtmlFile)"
                                                                                                     data-html="true"
                                                                                                     onerror="this.src='@Url.Content("~/Content/assets/images/icon_file.png")'"
                                                                                                     data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                                                                                     class="thumbnail" />
                                                                                                <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile" data="@fileDto.FileID"></i>
                                                                                        </div>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <label class="file-upload btn btn-info btn-outline">
                                                                                                Browse for file... <input type="file" id="file3" />
                                                                                            </label>

                                                                                        }
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td>4</td>
                                                                                    <td>
                                                                                        เก็บงานคือซ่อม
                                                                                    </td>
                                                                                    <td>
                                                                                        @if (Model != null && Model.Process != null
                                                                                                                   && Model.Process.Files != null
                                                                                                                   && Model.Process.Files.Count > 0
                                                                                                                  && Model.Process.Files.Find(o => o.No == "4") != null)
                                                                                        {
                                                                                            fileDto = Model.Process.Files.Find(o => o.No == "4");
                                                                                        <div class="upload_item">
                                                                                            <label class="file-upload btn btn-info btn-outline invisible">
                                                                                                Browse for file... <input type="file" id="file4" />
                                                                                            </label>
                                                                                            <a target="_blank" href="@Url.Content(fileDto.HtmlFile)">
                                                                                                <img src="@Url.Content(fileDto.HtmlFile)"
                                                                                                     data-html="true"
                                                                                                     onerror="this.src='@Url.Content("~/Content/assets/images/icon_file.png")'"
                                                                                                     data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                                                                                     class="thumbnail" />
                                                                                                <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile" data="@fileDto.FileID"></i>
                                                                                            </a>
                                                                                                </div>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <label class="file-upload btn btn-info btn-outline">
                                                                                                Browse for file... <input type="file" id="file4" />
                                                                                            </label>

                                                                                        }
                                                                                    </td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td>5</td>
                                                                                    <td>หลังซ่อม</td>
                                                                                    <td>
                                                                                        @if (Model != null && Model.Process != null
                                                                                                            && Model.Process.Files != null
                                                                                                            && Model.Process.Files.Count > 0
                                                                                                           && Model.Process.Files.Find(o => o.No == "5") != null)
                                                                                        {
                                                                                            fileDto = Model.Process.Files.Find(o => o.No == "5");
                                                                                        <div class="upload_item">
                                                                                            <label class="file-upload btn btn-info btn-outline invisible">
                                                                                                Browse for file... <input type="file" id="file5" />
                                                                                            </label>
                                                                                            <a target="_blank" href="@Url.Content(fileDto.HtmlFile)">
                                                                                                <img src="@Url.Content(fileDto.HtmlFile)"
                                                                                                     data-html="true"
                                                                                                     onerror="this.src='@Url.Content("~/Content/assets/images/icon_file.png")'"
                                                                                                     data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                                                                                     class="thumbnail" />
                                                                                                <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile" data="@fileDto.FileID"></i>
                                                                                        </a>
                                                                                                </div>

                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <label class="file-upload btn btn-info btn-outline">
                                                                                                Browse for file... <input type="file" id="file5" />
                                                                                            </label>

                                                                                        }
                                                                                    </td>
                                                                                </tr>


                                                                            </tbody>

                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                   
                                    @if (Model != null && Model.Process != null )
                                    {
                                        <div id="menu5" class="tab-pane fade @( Converting.ToInt(Model.Status)>=8 ? "in active" : "")">
                                            <div class="panel">
                                                <div class="panel-heading">
                                                    <div class="panel-title"></div>
                                                </div>
                                                <div class="panel-body">
                                                    <div class="row">
                                                       
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <div class="panel2-title">สำรวจ</div>

                                                                </div>
                                                                <div class="panel2-body">
                                                                    <div class="row" >

                                                                     
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab5SurveyDate">วันที่สำรวจ</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime disabled"
                                                                                           id="Tab5SurveyDate"
                                                                                           value="@(Model != null && Model.Survey != null  && Model.Survey.SurveyDate!=null && Model.Survey.SurveyDate!="" ? Model.Survey.SurveyDate : Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           placeholder="วันที่สำรวจ" data-plugin="datepicker">

                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5SurveyTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control disabled"
                                                                                           id="Tab5SurveyTime"
                                                                                           value="@(Model != null && Model.Survey != null ? Model.Survey.SurveyTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab5ddlSurveyAccountId">ผู้สำรวจ</label>
                                                                                <select class=" Tab5ddlSurveyAccountId disabled"
                                                                                        id="Tab5ddlSurveyAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ผู้สำรวจ...</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Survey != null && Model.Survey.SurveyAccountId != null && Model.Survey.SurveyAccountId != "" ? Model.Survey.SurveyAccountId.Trim() : (currentUser.UserLogin)) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-4 col-lg-4">
                                                                            <label for="SurveyLocation">สถานที่เกิดเหตุ</label>
                                                                            <div class="input-group">
                                                                                <input type="text" class="form-control disabled"
                                                                                       id="Tab5SurveyLocation"
                                                                                       value="@(Model != null && Model.Survey != null ? Model.Survey.Location : "")"
                                                                                       placeholder="สถานที่เกิดเหตุ" />

                                                                            </div>
                                                                        </div>


                                                                    </div>
                                                                </div>
                                                            </div>
                                                      
                                                    </div>
                                                        <div class="row">
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <label class="panel2-title">รายละเอียดการซ่อม</label>
                                                                </div>
                                                                <div class="panel2-body" style="padding:10px;">

                                                                    <div class="row">

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <input type="checkbox"
                                                                                       class="icheckbox-primary disabled"
                                                                                       id="Tab5IsSuccess"
                                                                                       @(Model != null && Model.Process != null && Model.Process.IsSuccess == "1" ? "checked" : "")
                                                                                       data-checkbox-class="icheckbox_flat-blue" />
                                                                                <label for="inputUnchecked">
                                                                                    ซ่อมเสร็จเรียบร้อย
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-2 col-lg-2">

                                                                            <div class="form-group">
                                                                                <label for="Tab5FromProcessDate">วันที่ดำเนินการ</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime disabled"
                                                                                           id="Tab5FromProcessDate"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.FromProcessDate!=null ? Model.Process.FromProcessDate :Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           placeholder="จากวันที่" data-plugin="datepicker">

                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5FromProcessTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control disabled"
                                                                                           id="Tab5FromProcessTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process!=null ? Model.Process.FromProcessTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5ToProcessDate">ถึงวันที่</label>
                                                                                <div class="input-group">
                                                                                    <input type="text" class="form-control datetime disabled"
                                                                                           id="Tab5ToProcessDate"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process!=null ? Model.Process.ToProcessDate :Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           placeholder="ถึงวันที่" data-plugin="datepicker">

                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5ToProcessTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control disabled"
                                                                                           id="Tab5ToProcessTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.ToProcessTime!=null ? Model.Process.ToProcessTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5ToProcessTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control disabled"
                                                                                           id="Tab5ToProcessTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.ToProcessTime!=null ? Model.Process.ToProcessTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5RepaireAccountId">ผู้ซ่อม</label>
                                                                                <select class=" Tab5RepaireAccountId disabled "
                                                                                        id="Tab5RepaireAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ผู้ซ่อม</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.RepaireAccountId != null ? Model.Process.RepaireAccountId.Trim() : currentUser.UserLogin) ? "selected" : "")>@it.Text </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-3 col-lg-3">

                                                                            <div class="form-group">
                                                                                <label for="Tab5SurfaceFixedDate">วันที่ซ่อมพื้นผิว</label>
                                                                                <div class="input-group">

                                                                                    <input type="text" class="form-control datetime disabled" placeholder="วันที่ซ่อมพื้นผิว"
                                                                                           id="Tab5SurfaceFixedDate"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.SurfaceFixedDate!=null ? Model.Process.SurfaceFixedDate :Converting.DateOfStartdd_MM_yyyyTH(DateTime.Now))"
                                                                                           data-plugin="datepicker">

                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5SurfaceFixedTime">เวลา</label>
                                                                                <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                    <input type="text" class="form-control disabled"
                                                                                           id="Tab5SurfaceFixedTime"
                                                                                           value="@(Model !=null && Model.Process != null && Model.Process.SurfaceFixedTime!=null ? Model.Process.SurfaceFixedTime :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                           placeholder="เวลา">

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab5SuperAccountId">จน.ผู้ควบคุมงานซ่อม</label>
                                                                                <select class=" Tab5SuperAccountId  disabled"
                                                                                        id="Tab5SuperAccountId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">จน.ผู้ควบคุมงานซ่อม</option>
                                                                                    @foreach (DropDownlistDto it in Employees)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.SuperAccountId != null ? Model.Process.SuperAccountId.Trim() : currentUser.UserLogin) ? "selected" : "")>@it.Text </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-4 col-lg-4">
                                                                            <div class="form-group">
                                                                                <label for="Tab5TeamId">ทีม</label>
                                                                                <select class=" Tab5TeamId disabled"
                                                                                        id="Tab5TeamId"
                                                                                        tabindex="-98">
                                                                                    <option value="0">ทีม...</option>
                                                                                    @foreach (DropDownlistDto it in SysTeam)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.TeamId != null ? Model.Process.TeamId.Trim() : "") ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>

                                                                        </div>
                                                                    </div>
                                                                    <div class="row">

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group">
                                                                                <label for="Tab5BrokenAppearance">ลักษณะการแตกของท่อจริง</label>
                                                                                <input type="text" class="form-control disabled"
                                                                                       id="Tab5BrokenAppearance"
                                                                                       value="@(Model !=null && Model.Process != null
                                                                             && Model.Process.BrokenAppearance!=null
                                                                             && Model.Process.BrokenAppearance!=""?
                                                                             Model.Process.BrokenAppearance
                                                                             : (Model.Survey != null
                                                                                && Model.Survey.BrokenAppearance!=null ?
                                                                                Model.Survey.BrokenAppearance : ""))"
                                                                                       placeholder="ลักษณะการแตกของท่อจริง" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5PiplineType">ชนิดของท่อ</label>
                                                                                <select class=" Tab5PiplineType disabled"
                                                                                        id="Tab5PiplineType">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysGISPIPETYPE)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.PiplineType != null && Model.Process.PiplineType != ""  && Model.Process.PiplineType != "0" ? Model.Process.PiplineType : (Model.Survey != null && Model.Survey.PiplineType != null && Model.Survey.PiplineType != "" ? Model.Survey.PiplineType : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>

                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5PiplineSize">ขนาดของท่อ</label>
                                                                                <select class=" Tab5PiplineSize disabled"
                                                                                        id="Tab5PiplineSize">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysPipelineSize)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.PiplineSize != null && Model.Process.PiplineSize != "" && Model.Process.PiplineSize != "0"  ? Model.Process.PiplineSize : (Model.Survey != null && Model.Survey.PiplineSize != null ? Model.Survey.PiplineSize : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-3 col-lg-3">
                                                                            <div class="form-group" style="padding-top:30px;">
                                                                                <input type="checkbox" class="icheckbox-primary disabled"
                                                                                       @(Model != null && Model.Process != null && Model.Process.IsNotGIS == "1" ? "checked" : "")
                                                                                       id="Tab5IsNotGIS" />
                                                                                <label for="Tab5IsNotGIS">GIS ไม่ตรงกับหน้างาน</label>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5SurfaceAppearance">ลักษณะพื้นผิว</label>
                                                                                <select class=" Tab5SurfaceAppearance disabled"
                                                                                        id="Tab5SurfaceAppearance">
                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                    @foreach (DropDownlistDto it in SysSurface)
                                                                                    {
                                                                                        <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.Process != null && Model.Process.SurfaceAppearance != null && Model.Process.SurfaceAppearance != "" ? Model.Process.SurfaceAppearance : (Model.Survey != null && Model.Survey.SurfaceAppearance != "" ? Model.Survey.SurfaceAppearance : "")) ? "selected" : "")>
                                                                                            @it.Text
                                                                                        </option>
                                                                                    }

                                                                                </select>


                                                                            </div>
                                                                        </div>


                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label>
                                                                                    ขนาดหลุม
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5HoleWidth">กว้าง</label>
                                                                                <input type="text" class="form-control disabled"
                                                                                       id="Tab5HoleWidth"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.HoleWidth!=null ? Model.Process.HoleWidth :"")"
                                                                                       placeholder="กว้าง" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5HoleLength">ยาว</label>
                                                                                <input type="text" class="form-control disabled"
                                                                                       id="Tab5HoleLength"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.HoleLength!=null ? Model.Process.HoleLength :"")"
                                                                                       placeholder="ยาว" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-2 col-lg-2">
                                                                            <div class="form-group">
                                                                                <label for="Tab5HoleDepth">ลึก</label>
                                                                                <input type="text" class="form-control disabled"
                                                                                       id="Tab5HoleDepth"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.HoleDepth!=null ? Model.Process.HoleDepth :"")"
                                                                                       placeholder="ลึก" />
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-4 col-lg-4">
                                                                            <div class="form-group">
                                                                                <label for="Tab5ToolType">เครื่องมือที่ใช้</label>
                                                                                <input type="text" class="form-control disabled"
                                                                                       id="Tab5ToolType"
                                                                                       value="@(Model !=null && Model.Process != null && Model.Process.ToolType!=null ? Model.Process.ToolType :"")"
                                                                                       placeholder="เครื่องมือที่ใช้" />
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>


                                                        <div class="row">
                                                            <div class="panel2">
                                                                <div class="panel2-header">
                                                                    <label class="panel2-title">ปิดงานซ่อม</label>

                                                                </div>
                                                                <div class="panel2-body" style="padding:10px;">
                                                                    <div class="row">
                                                                        <div class="col-md-12 col-lg-12">
                                                                            <div class="row">
                                                                                <div class="col-md-12 col-lg-12">
                                                                                    @if (Model != null && Model.CloseJob != null)
                                                                                    {
                                                                                        <a class="btn btn-outline btn-warning pull-right"
                                                                                           href="@Url.Action("PDFCloseRepair", "Pdf", new { id = Model.RWId })"
                                                                                           target="_blank">พิมพ์ใบปิดงานซ่อม</a>
                                                                                    }

                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-4 col-lg-4">
                                                                                    <div class="form-group ">
                                                                                        <input type="text" class="form-control disabled" id="CloseJobNumber" value="@(Model !=null  && Model.CloseJob!=null ? Model.CloseJob.CloseJobNumber.ToString() :"")" placeholder="เลขที่ใบปิดงานซ่อม" />
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-3 col-lg-3">
                                                                                    <div class="form-group">
                                                                                        <div class="input-group">
                                                                                            <input type="text" class="form-control datetime"
                                                                                                   id="Tab5CloseDate"
                                                                                                   value="@(Model !=null  && Model.CloseJob!=null ? Model.CloseJob.CloseDate.ToString() :Converting.DateOfdd_MM_yyyyTH(DateTime.Now))"
                                                                                                   placeholder="จากวันที่" data-plugin="datepicker">
                                                                                            <span class="input-group-addon ">
                                                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                                                            </span>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>
                                                                                <div class="col-md-2 col-lg-2">
                                                                                    <div class="form-group">
                                                                                        <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                                                                            <input type="text" class="form-control"
                                                                                                   value="@(Model !=null  && Model.CloseJob!=null ? Model.CloseJob.CloseTime.ToString() :Converting.DateOfHHmmTH(DateTime.Now))"
                                                                                                   id="Tab5CloseTime"
                                                                                                   placeholder="เวลา">
                                                                                        </div>
                                                                                    </div>
                                                                                </div>


                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-4 col-lg-4">
                                                                                    <div class="form-group ">
                                                                                        <label>รายการวัสดุอุปกรณ์ที่ใช้</label> <button type="button" class="btn btn-floating btn-success btn-sm btnAddNewItem"><i class="icon wb-plus" aria-hidden="true"></i></button>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-7 col-lg-7">
                                                                                    <div class="divCloseCase_Template">


                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-12 col-lg-12">
                                                                                    <div class="table-responsive divCloseJob">
                                                                                        <div class="divItem">
                                                                                            <table class="table tbItem"
                                                                                                   data-selectable="selectable">
                                                                                                <thead>
                                                                                                    <tr>


                                                                                                        <th class="" scope="col"></th>

                                                                                                        <th scope="col" class="cell-200">รายการ</th>
                                                                                                        <th class="cell-120" scope="col">หน่วยนับ</th>
                                                                                                        <th scope="col" class="">จำนวน</th>
                                                                                                        <th scope="col" class="">ราคาต่อหน่วย</th>
                                                                                                        <th scope="col" class="cell-80">ราคารวม</th>
                                                                                                        <th scope="col" class=""></th>

                                                                                                    </tr>
                                                                                                </thead>
                                                                                                <tbody>

                                                                                                    @if (Model != null && Model.Items != null)
                                                                                                    {
                                                                                                        foreach (PwaRepaireWork_ItemDto item in Model.Items)
                                                                                                        {

                                                                                                            <tr>

                                                                                                                <td class=""><label class="lbNo">@item.No</label></td>
                                                                                                                <td>

                                                                                                                    <select class="form-control  selItem ">

                                                                                                                        <option value="0">กรุณาเลือก</option>
                                                                                                                        @foreach (DropDownlistDto it in SysItems)
                                                                                                                        {
                                                                                                                            <option value="@it.Value" @(item.ItemId == it.Value ? "Selected" : "")>@it.Text </option>
                                                                                                                        }
                                                                                                                    </select>


                                                                                                                </td>
                                                                                                                <td class="">
                                                                                                                    <select class="form-control selUnit ">
                                                                                                                        <option value="0">กรุณาเลือก</option>
                                                                                                                        @foreach (DropDownlistDto it in SysUnit)
                                                                                                                        {
                                                                                                                            <option value="@it.Value" @(item.UnitId == it.Value ? "Selected" : "")>@it.Text </option>
                                                                                                                        }
                                                                                                                    </select>
                                                                                                                </td>
                                                                                                                <td class=""><input type="text" onkeypress="return isNumber(event)" value="@item.Qty" class="form-control txtQty" /></td>
                                                                                                                <td class=""><input type="text" onkeypress="return isNumber(event)" value="@item.Price" class="form-control txtPrice" /></td>
                                                                                                                <td class=""><label class="lbTotal">@item.Total</label></td>
                                                                                                                <td>   <button type="button" class="btn btn-floating btn-danger btn-sm btnDeleteItem"><i class="icon wb-close" aria-hidden="true"></i></button></td>
                                                                                                            </tr>
                                                                                                        }
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        <tr>

                                                                                                            <td class="">
                                                                                                                <label class="lbNo">1</label>
                                                                                                            </td>
                                                                                                            <td>

                                                                                                                <select class="form-control  selItem">

                                                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                                                    @foreach (DropDownlistDto it in SysItems)
                                                                                                                    {
                                                                                                                        <option value="@it.Value"> @it.Text </option>
                                                                                                                    }
                                                                                                                </select>


                                                                                                            </td>
                                                                                                            <td class="">
                                                                                                                <select class="form-control selUnit ">
                                                                                                                    <option value="0">กรุณาเลือก</option>
                                                                                                                    @foreach (DropDownlistDto it in SysUnit)
                                                                                                                    {
                                                                                                                        <option value="@it.Value"> @it.Text </option>
                                                                                                                    }
                                                                                                                </select>
                                                                                                            </td>
                                                                                                            <td class=""><input type="text" onkeypress="return isNumber(event)" class="form-control txtQty" /></td>
                                                                                                            <td class=""><input type="text" onkeypress="return isNumber(event)" class="form-control txtPrice" /></td>
                                                                                                            <td class=""><label class="lbTotal">0.00</label></td>
                                                                                                            <td>   <button type="button" class="btn btn-floating btn-danger btn-sm btnDeleteItem"><i class="icon wb-close" aria-hidden="true"></i></button></td>
                                                                                                        </tr>
                                                                                                    }



                                                                                                </tbody>
                                                                                                <tfoot>
                                                                                                    <tr class="bg-secondary">
                                                                                                        <td colspan="5" class=""> <h3 class="text-success ">รวม</h3></td>
                                                                                                        <td>
                                                                                                            <h3 class=" text-success lblSummary">
                                                                                                                @((Model != null && Model.Items != null) ? Model.Items.Sum(o => Converting.ToDoble(o.Total)).ToString("##,##0.00") : "0.00")

                                                                                                            </h3>

                                                                                                        </td>
                                                                                                        <td></td>

                                                                                                    </tr>

                                                                                                </tfoot>
                                                                                            </table>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-4 col-lg-4">
                                                                                    <div class="form-group">
                                                                                        <label for="Tab5DocumentId">แนบเอกสาร</label>
                                                                                        <select class="Tab5DocumentId"
                                                                                                id="Tab5DocumentId">
                                                                                            <option value="0">กรุณาเลือก</option>
                                                                                            @foreach (DropDownlistDto it in ViewBag.SysDocumentType)
                                                                                            {
                                                                                                <option value="@it.Value" @(it.Value.Trim() == (Model != null && Model.CloseJob != null && Model.CloseJob.DocumentId != null && Model.CloseJob.DocumentId != "" ? Model.CloseJob.DocumentId : "0") ? "selected" : "")>
                                                                                                    @it.Text
                                                                                                </option>
                                                                                                }

                                                                                            </select>


                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6 col-lg-6" style="padding-top:28px">
                                                                                    <label class="closefile-upload btn btn-info btn-outline">
                                                                                        เลือกไฟล์
                                                                                    </label>
                                                                                    <br />
                                                                                    <br />
                                                                                    <div id="pnl_upload_tools" style="display:none;">
                                                                                        <input type="file" class="upload" name="upload" data-idx="1" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="2" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="3" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="4" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="5" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="6" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="7" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="8" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="9" />
                                                                                        <input type="file" class="upload" name="upload" data-idx="10" />
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-12">
                                                                                    <div class="col-12">
                                                                                        <div class="row display_upload">
                                                                                            @if (Model != null
                                                                                                && Model.CloseJob != null
                                                                                                && Model.CloseJob.Files.Count > 0
                                                                                                 //&& Model.Files.Find(o => o.No == "1") != null
                                                                                                 )
                                                                                            {
                                                                                                List<FileDto> _files = Model.CloseJob.Files.Where(o => "1" == "1").ToList();

                                                                                                foreach (var _fileDto in _files)
                                                                                                {
                                                                                                    <div class="upload_item" data-id="@_fileDto.FileID">
                                                                                                        <a target="_blank" href="@Url.Content(_fileDto.HtmlFile)">
                                                                                                            <img src="@Url.Content(_fileDto.HtmlFile)" onerror="this.src='@Url.Content("~/Content/assets/images/icon_file.png")'"
                                                                                                                 @*data-toggle="popover"*@
                                                                                                                 data-html="true"
                                                                                                                 data-content="<img src='@Url.Content(_fileDto.HtmlFile)' style='width:100%'></img>"
                                                                                                                 class="thumbnail" />
                                                                                                        </a>
                                                                                                        <i class="glyphicon glyphicon-remove icon-2x text-primary btnDeleteCloseJobfile vertical-align-middle" data="@_fileDto.FileID"></i>
                                                                                                    </div>
                                                                                                }
                                                                                            }
                                                                                        </div>
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        </div>
                                                                    </div>
                                                            </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                    }
                    <div class="row" style="padding-top:10px;padding-bottom:10px">
                        <div class="col-md-12  text-center">
                            <input type="hidden" id="hddRWId" value="@(Model !=null  ? Model.RWId.ToString() :"")" />
                            <input type="hidden" id="hddStatus" value="@(Model !=null  &&  Model.Status !=null  &&  Converting.ToInt(Model.Status)>0 ? Model.Status :"5")" />
                            <button class="btn btn-outline btn-primary btnSave" type="submit">บันทึก</button>
                            <a class="btn  btn-outline btn-default" data-dismiss="modal" href="javascript:void(0)">ล้างหน้าจอ</a>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>


<div class="modal modal-primary  fade" id="mdPipeHistory" aria-hidden="true" aria-labelledby="mdPipeHistory" role="dialog">
    <div class="modal-dialog modal-simple modal-lg">
        <div class="modal-content">
            <div class="modal-header modal-primary">
                <button type="button" class="close" aria-hidden="true" data-dismiss="modal">×</button>
                <h4 class="modal-title">ประวัติการซ่อมท่อ</h4>
            </div>
            <div class="modal-body" style="padding-top:10px">
                <div role="row">
                    <div class="col-md-12 col-lg-12">
                        <div class="divPipelineHistory">
                            <div class="divSection1">
     
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="preview-box">
                                                    <div class="row">

                                                        <div class="col-sm-8">
                                                            <div class="form-group">
                                                                <label for="txtPHLocation">บริเวณที่วางท่อ</label>
                                                                <input type="text" class="form-control disabled txtPHLocation"
                                                                       value="" name="txtPHLocation" />
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group">
                                                                <label for="txtPHYear">
                                                                    ปี พ.ศ ที่ทำการวางท่อ
                                                                </label>
                                                                <input type="text" class="form-control disabled txtPHYear"
                                                                       value="" name="txtPHLocation" />
                                                            </div>
                                                        </div>

                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label for="txtPHPipeType">
                                                                    ชนิดท่อ
                                                                </label>
                                                                <input type="text" class="form-control disabled txtPHPipeType"
                                                                       value="" name="txtPHPipeType" />
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label for="txtPHPipeSize">
                                                                   ขนาดท่อ (เมตร)
                                                                </label>
                                                                <input type="text" class="form-control disabled txtPHPipeSize"
                                                                       value="" name="txtPHPipeSize" />
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label for="txtPHPipeLong">
                                                                  ความยาวท่อ (เมตร)
                                                                </label>
                                                                <input type="text" class="form-control disabled txtPHPipeLong"
                                                                       value="" name="txtPHPipeLong" />
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label for="txtPHPipeDepth">
                                                                    ความลึกท่อ (เมตร)
                                                                </label>
                                                                <input type="text" class="form-control disabled txtPHPipeDepth"
                                                                       value="" name="txtPHPipeDepth" />
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-10">
                                                            <div class="form-group">
                                                                <label for="txtPHRemark">หมายเหตุ</label>
                                                                <input type="text" class="form-control disabled txtPHRemark"
                                                                       value="" name="txtPHRemark" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12">
                                                    <div class="preview-box"  style="margin-top:15px;">
                                                        <div class="table-responsive  divPipelineHistoryTable">
                                                            <table class="table   table-hover">
                                                                <thead>
                                                                    <tr>
                                                                        <th class="cell-300" scope="col">วันเวลาที่ซ่อม</th>
                                                                        <th scope="col" class="cell-300">สถานที่จุดซ่อม</th>
                                                                        <th scope="col" class="cell-300">สาเหตุที่ท่อรั่ว</th>
                                                                        <th scope="col" class="cell-300">รายละเอียดงานซ่อม</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                        </div>
                                                    </div>

                                                </div>
                                            <div class="col-sm-12">
                                              
                                                    <div id="maphistoryid" style="margin-top:10px">
                                                    </div>
                                              

                                            </div>
                                                <div class="col-xl-12" align="center">
                                                    <div class=" form-group">

                                                        <button class="btn btn-outline-default">ปิด</button>
                                                    </div>
                                                </div>
                                            </div>
                        
                              
                             
                            </div>
                        </div>


                    </div>
                </div>
              
            </div>
        </div>
    </div>
</div>

<script>
    var map;
    var maphistory;
    var maptileLayer;
    var mapPrinter;
    var keepDeleteFiles = [];
    var keepDeleteCloseFiles = [];
    var locationEffectLalong;
    var localCurrentLayer;
    var currentLayer;
    var editGroupLayers;
    var editLayers,editPipelineBufferLayer, editDrawBufferLayers;
    var incidentGroupLayer;
    var incidentLayers = [];


    var pipeGroupLayer;
    var measureControl;


    var customerGroupLayer;
    var customerLayers = [];


    var PipeImageWmsGroupLayer;
    var currentUrl = getBaseUrl();
    var incidentStyle = L.Icon.extend({
        options: {
            iconSize: [27, 27],

        }
    });


    var polygonStyle = {
        radius: 8,
        fillColor: "#ff7800",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
    };

    var SurveyGroupLayer;
    var surveMarker;

    var AreaGroupLayer;

    var PipeEffectObjs = null;

    var historyGroupLayer;


   var currentToolType = '@(Model!=null && Model.Effect!=null ? Model.Effect.ToolType : "")';
    var incidentMaker = new incidentStyle({ iconUrl : currentUrl+'/icon/incident.png' });
    //var popupMaker = "จุดที่พบ<br><button class='btn btn-outline-primary btnEffect'>ยืนยัน</button>&nbsp;<button class='btn btn-outline-danger btnDeleteMaker'>ลบ</button>";


    var AddRepaire = '@Url.Action("AddRepaire", "Complaint", new { id = "" })'


var PageController = {
	init: function () {
		$(document).ready(function () {

			$(".datetime").datepicker()
            $('.clockpicker').clockpicker();
            $('.file-upload').file_upload();
            if ($("#hddRWId").val() != "") {
                PageController.LoadMap();
               $('.file-upload').file_upload();
            }

       $(".selItem").select2({
           maximumSelectionLength: 2,
           width: '100%'
       });

            $("#Status").select2({
                maximumSelectionLength: 2,
                width: '100%'
            }).prop("disabled", true);
         
            $(".PiplineType,.PiplineSize,.SurfaceAppearance,.Tab3PiplineType,.Tab3PiplineSize,.Tab3SurfaceAppearance,.Tab3OpenAccountId,.Tab3TeamId,#txtBuffer,.Tab4RepaireAccountId,.Tab4TeamId,.Tab4PiplineType,.Tab4PiplineSize,.Tab4SurfaceAppearance").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });



            $("#Tab5ddlSurveyAccountId,#Tab5SuperAccountId,#Tab5TeamId,#Tab5PiplineType,#Tab5PiplineSize,#Tab5SurfaceAppearance,#Tab5RepaireAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
            $(".disabled").prop("disabled", true);
        


            
            
            $("#Tab5DocumentId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $("#ddlSlaDetail").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
            $(".ddlSurveyAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
            $(".Tab3SurveyAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $(".Tab3ResponAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $(".Tab4SuperAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $("#Tab3SysItemSetID").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });



            $("#ddlToolType").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });



            $("#ddlAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });


            $("#Tab3ResponAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $("#Tab3SuperAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $(".selUnit").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $("#ddlSurveyAccountId").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $(".ddlBranch").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $(".ddlBranchSearch").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });




            $("#ddlRequestType").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $("#ddlRequestCategory").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
            $("#ddlRequestCategorySubject").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
          /*  $(".select2").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
            */

            PageController.LoadEvent();
            if (model != null) {
                PageController.SetData(model);


            } else {
                PwaManager.pwaMapPWABranchAndPipe(map, $(".ddlBranch").val(), AreaGroupLayer, PipeImageWmsGroupLayer, false);

            }


		})

     //   PageController.LoadMap();
	},
	LoadEvent: function () {


        $(".btnDownload").on('click', function () {
            html2canvas($("#mapid"), {
                onrendered: function (canvas) {
                    $("#previewImage").append(canvas);
                    getCanvas = canvas;
                }
            });
        });
		$(document).on("click", "#Tab3IsUrgent", function () {


			//  $("#chkTab3Fix2").prop('checked', !$(this).is(':checked'));
        });
        $(document).on("click", ".btnStreetView", function (e) {
            if ($("#streetPanorama").hasClass("hidden")) {
                $("#streetPanorama").removeClass("hidden")
            } else {
                $("#streetPanorama").addClass("hidden")
            }
        });

        $('.closefile-upload').click(function () {
            _upload_file();
        });


        $(document).on("change", ".ddlBranch", function (e) {

            PwaManager.pwaMapPWABranchAndPipe(map, $(this).val(), AreaGroupLayer, PipeImageWmsGroupLayer);

        });
        $(document).on("change", ".ddlBranchSearch", function (e) {
            $(".ddlBranch").val($(this).val()).trigger("change");
       //     PwaManager.pwaMapPWAAreaAndPipe(map, $(this).val(), AreaGroupLayer, PipeImageWmsGroupLayer);

        });

        $(document).on("change", "#Tab3SysItemSetID", function (e) {

            var SetID = $(this).val();
            if ($('table.tbItem  > tbody  > tr').length > 1) {

                PwaManager.PwaConfirm("Template", "คุณต้องการแทนที่วัสดุอุปกรณ์?", function (isConfirm) {
                    if (!isConfirm) {
                        swal.close();
                        return;
                    } else {

                        var data = {};
                        data.SetID = SetID;
                        PwaManager.PwaPost(itemUrl + "GetTemplateBySetID", data, function (resObj) {
                            swal.close();
                            PageController.LoadOpenCaseItems(resObj);

                        });
                    }
                });
            } else {
                var data = {};
                data.SetID = SetID;
                PwaManager.PwaPost(itemUrl + "GetTemplateBySetID", data, function (resObj) {
                    swal.close();
                    PageController.LoadOpenCaseItems(resObj);

                });
            }

        });



        $(document).on("keyup", ".txtQty", function () {
            var row = $(this).closest("tr");
            PageController.CalculateItem(row.find(".selItem"),
                row.find(".selUnit"),
                row.find("input.txtQty"),
                row.find("input.txtPrice"),
                row.find(".lbTotal")
                , true);
        });

        $(document).on("keyup", ".txtPrice", function () {
            var row = $(this).closest("tr");
            PageController.CalculateItem(row.find(".selItem"),
                row.find(".selUnit"),
                row.find("input.txtQty"),
                row.find("input.txtPrice"),
                row.find(".lbTotal")
                ,true
            );
        });

        $(document).on("change", ".selItem", function () {
            var row = $(this).closest("tr");
            PageController.CalculateItem(row.find(".selItem"),
                row.find(".selUnit"),
                row.find("input.txtQty"),
                row.find("input.txtPrice"),
                row.find(".lbTotal"));
        });

        $(document).on("change", ".selUnit", function () {
            var row = $(this).closest("tr");
            PageController.CalculateItem(row.find(".selItem"),
                row.find(".selUnit"),
                row.find("input.txtQty"),
                row.find("input.txtPrice"),
                row.find(".lbTotal") );

        });


        $(document).on("click", ".btnExpandMap", function () {


            if ($("#mapid").hasClass("mapfull")) {
                $(this).text("Full Size");
                $(".mapsection").removeClass("fullScreen");
                $("#mapid").removeClass("mapfull")
                $(".divSurveyTool").appendTo('.divSurveyToolSection')
            } else {
                $(this).text("Normal Size");
                $(".mapsection").addClass("fullScreen");
                $("#mapid").addClass("mapfull")
                $(".divSurveyTool").appendTo('.divSurveyToolSectionMap')
            }


            setTimeout(function () {

                map.invalidateSize();

            }, 10);
        });


		$(document).on("click", "#Tab3IsOutSource", function () {
			//    $("#chkTab3Fix1").prop('checked', !$(this).is(':checked'));
		});

		$(document).on("click", ".nav-link", function () {
			if ($(this).attr("href") == "#menu1") {
				setTimeout(function () {
					document.getElementById('menu1').style.display = 'block';
					map.invalidateSize();
				}, 10);
			} else {
				document.getElementById('menu1').style.display = '';
            }

            // Open case
            if ($(this).attr("Status") == "6") {

                $(".divItem").appendTo('.divOpenCase')
                $(".divTemplate").appendTo('.divOpenCase_Template')
            }
            // Close Job
            else if ($(this).attr("Status") == "8") {
                $(".divItem").appendTo('.divCloseJob')
                $(".divTemplate").appendTo('.divCloseCase_Template')
            }
        });

        $(document).on("click", ".btnDeleteItem", function () {
            var row = $(this).closest("tr");
            row.remove();
            PageController.CalculateSummary();
        })

        $(document).on("click", ".btnDeleteMaker", function () {

            SurveyGroupLayer.clearLayers();
            surveMarker = null;
        });
        

        $(document).on("click", ".btnAddNewItem", function () {

            var detailTable = $("table.tbItem > tbody");

            var rowCount = $('table.tbItem tr').length
            var newRow = "";
            newRow += "<tr>";
            newRow += "<td><label class='lbNo'>" + rowCount+"</label></td>";
            newRow += "<td>   <select class='form-control  selItem'></select></td>";
            newRow += "<td> <select class='form-control  selUnit'></select></td>";
            newRow += "<td><input type='text'  onkeypress='return isNumber(event)' class='form-control txtQty' /></td>";
            newRow += "<td><input type='text'  onkeypress='return isNumber(event)' class='form-control txtPrice' /></td>";
            newRow += "<td><label class='lbTotal'>0.00</label></td>";
            newRow += "<td>  <button type='button' class='btn btn-floating btn-danger btn-sm btnDeleteItem'><i class='icon wb-close' aria-hidden='true'></i></button></td>";
            newRow += "</tr>";
            detailTable.append(newRow);

            $('table.tbItem  > tbody  > tr:last').each(function () {

                var row = $(this);

                PwaManager.PwaSelect2(row.find(".selItem"), SysItems);
                PwaManager.PwaSelect2(row.find(".selUnit"), SysUnit);
            });

         /*   $trLast = $('.tbItem > tbody').find("tr:last"),
                $trNew = $trLast.clone();
            $trNew.find("td:eq(0)").text(rowCount)
            $trNew.find("td:eq(4)").text("0.00")
            $trNew.find("td:eq(2)").find("span.select2").remove();
            $trNew.find("td:eq(2)").find("select").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });
            $trLast.after($trNew);*/


        /*    $trNew.find(".selUnit").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });

            $trNew.find(".selItem").select2({
                maximumSelectionLength: 2,
                width: '100%'
            });*/
//$('.tbItem > tbody').append(newRow);
        });


        $(document).on("click", ".btnEffect", function () {

            var selecLayer;
            editGroupLayers.clearLayers();

            if ($("#ddlToolType").val() != "2" && $("#ddlToolType").val() != "4"   ) {

                if (editGroupLayers != null) {
                    editGroupLayers.clearLayers();
                }
                PageController.GetNearPipeAndPoint(surveMarker.getLatLng().lat, surveMarker.getLatLng().lng, PageController.GetIdBySelect2($(".ddlBranch")));
            }

            switch ($("#ddlToolType").val())
            {
                // Buffer in line
                case "1":
                 //   pipeGroupLayer.clearLayers();
                  //  pipeGroupLayer.addLayer(editPipelineBufferLayer);
                   // selecLayer = surveMarker.toGeoJSON();
               if(editPipelineBufferLayer!=null)
                   selecLayer = editPipelineBufferLayer.toGeoJSON();
                    PageController.AddBuffer(selecLayer, editGroupLayers, $("#txtBuffer").val());
                    break;

                    // drawshape in line
                case "2":
                    if (currentToolType == $("#ddlToolType").val()) {
                        editGroupLayers.addLayer(editDrawBufferLayers);
                    }
                   // selecLayer = editDrawBufferLayers;
                    break;
                case "3": break;
                case "4":
                    if (currentToolType == $("#ddlToolType").val()) {
                        editGroupLayers.addLayer(editDrawBufferLayers);
                    }
                    // selecLayer = editDrawBufferLayers;
                    break;
            }



            if ($("#ddlToolType").val() == "0") {


                swal({
                    title: "สร้าง/เลือกข้อมูล!",
                    text: `กรุณาเลือกเครื่องมือในการประเมินผลกระทบ!`,
                    timer: 1500,
                    type: "warning",
                });

                return false;
            }
            if (customerGroupLayer != null) {
                customerGroupLayer.clearLayers();
            }
            if (pipeGroupLayer != null) {
                pipeGroupLayer.clearLayers();
            }
           


        });

        $(document).on("change", "#ddlToolType", function () {

            if ($(this).select2("data")[0].id == "1" ) {
                $(".divBuffer").removeClass("invisible");
            } else if ($(this).select2("data")[0].id == "2" || $(this).select2("data")[0].id == "4") {
                $(".divBuffer").removeClass("invisible").addClass("invisible");
            } else if ($(this).select2("data")[0].id == "3") {
                $(".divBuffer").removeClass("invisible").addClass("invisible");
        }


        });

        $(document).on("click", ".btnRepaireHistory", function () {
            PageController.GetRepaireHistoryByPipe(PipeEffectObjs, PageController.GetIdBySelect2($(".ddlBranch")));
        });
		$(document).on("click", ".btnSave", function () {
      //     $(this).attr("disabled", 'disabled');

        //   mapPrinter.printMap('CurrentSize', 'MyManualPrint')
         //   mapPrinter._dataURItoBlob();

            if (PageController.Validate()) {


                PwaManager.PwaConfirm("บันทึก", "คุณต้องการบันทึกหรือไม่", function (isConfirm) {
                    if (isConfirm) {
                        var obj = PageController.GetData();
                        $("button.confirm").attr("disabled", 'disabled');
                        PwaManager.PwaPostFormData(addUrl, obj, function (resObj) {
                            swal({
                                title: "สำเร็จ!",
                                text: "บันทึกข้อมูลเรียบร้อย!",
                                timer: 1500
                            });

                            window.setTimeout(function () {
                                window.location.href = AddRepaire + "/" + resObj.RWId;
                            }, 1000);
                        });
                        /*   swal(
                               {
                                   title: "สำเร็จ!",
                                   text: "บันทึกข้อมูลเรียบร้อย!",
                                   timer: 800
                               });*/

                    } else {
                        $(".btnSave").removeAttr("disabled");
                        $("button.confirm").removeAttr("disabled");
                        swal.close();
                        $("#InputForm").modal({
                            backdrop: 'static',
                            keyboard: false
                        });
                    }
                })
            }

		});
		$(document).on("change", ".ddlRequestType", function (e) {

			$("select.ddlRequestCategory").find('option').remove();
			$("select.ddlRequestCategorySubject").find('option').remove();

			var selCategory = SysRequestCategorys.filter(o => o.ParentId1 == $(this).val());
            $("select.ddlRequestCategory").append("<option value='0'>กรุณาเลือก</option>");
			$.each(selCategory, function (index, item) {
				$("select.ddlRequestCategory").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
			});
			$("select.ddlRequestCategory").selectpicker('refresh');
			$("select.ddlRequestCategorySubject").selectpicker('refresh');
			$("select.ddlRequestCategory").trigger("change");
			e.stopPropagation();
		});

		$(document).on("change", ".ddlRequestCategory", function (e) {

			$("select.ddlRequestCategorySubject").find('option').remove();

			//  alert($(this).val())
			var selCategory = SysRequestCategorySubjects.filter(o => (o.ParentId1 == $(this).val() && o.ParentId2 == $(".ddlRequestType").selectpicker("val")));

          
            $("select.ddlRequestCategorySubject").append("<option value='0'>กรุณาเลือก</option>");
			$.each(selCategory, function (index, item) {
				$("select.ddlRequestCategorySubject").append("<option value='" + item.Value + "'>" + item.Text + "</option>");
			});
			$("select.ddlRequestCategorySubject").selectpicker('refresh');
			e.stopPropagation();
		});

		$(document).on('click', '.btnDeletefile', function (e) {


            if ($(this).attr('data') != null) {
                let objProcessFile = {};
                objProcessFile.FileID = $(this).attr('data');
                objProcessFile.RWId = $("#hddRWId").val();
                objProcessFile.HtmlFile = $(this).closest("div").find("img").attr("src");
                keepDeleteFiles.push(objProcessFile);
				$(this).closest("div").find("img").remove();
				$(this).closest("div").find("label.file-upload").removeClass("invisible");
				$(this).remove();

			}
        });



        $(document).on("show.bs.modal", "#mdPipeHistory", function () {
            setTimeout(function () {
                document.getElementById('mdPipeHistory').style.display = 'block';
              maphistory.invalidateSize();
            });
        });
        $('#pnl_upload_tools .upload').change(function () {
            readURL(this);
        });

        $(document).on('click', '.btnDeleteCloseJobfile', function (e) {
            var focus = $(this).parents('.upload_item:first');
       if ($(this).attr('data') != null) {
           let objCloseFile = {};
           objCloseFile.FileID = $(this).attr('data');
           objCloseFile.RWId = $("#hddRWId").val();
           objCloseFile.HtmlFile = $(this).closest("div").find("img").attr("src");
           keepDeleteCloseFiles.push(objCloseFile);
           $(this).closest("div").find("img").remove();
          // $(this).closest("div").find("label.file-upload").removeClass("invisible");
           $(this).remove();
           focus.remove();
       }

            });

    },
    LoadOpenCaseItems(data) {

        var detailTable = $("table.tbItem > tbody");

        detailTable.find("tr").remove();
        var rowCount = $('table.tbItem tr').length;
        var rowCount = 1;
        var newRow = "";

        $.each(data, function (index, item) {
            newRow += "<tr>";
            newRow += "<td><label class='lbNo'>" + rowCount + "</label></td>";
            newRow += "<td>   <select class='form-control  selItem'></select></td>";
            newRow += "<td> <select class='form-control  selUnit'></select></td>";
            newRow += "<td><input type='text'  onkeypress='return isNumber(event)' class='form-control txtQty' /></td>";
            newRow += "<td><input type='text'  value='" + item.Price+"'  onkeypress='return isNumber(event)' class='form-control txtPrice' /></td>";
            newRow += "<td><label class='lbTotal'>0.00</label></td>";
            newRow += "<td>  <button type='button' class='btn btn-floating btn-danger btn-sm btnDeleteItem'><i class='icon wb-close' aria-hidden='true'></i></button></td>";
            newRow += "</tr>";
            detailTable.append(newRow);
            var row = $('table.tbItem  > tbody > tr:last');
            PwaManager.PwaSelect2(row.find(".selItem"), SysItems, item.ItemId);
            PwaManager.PwaSelect2(row.find(".selUnit"), SysUnit, item.UnitId);
            rowCount++;
            newRow = "";
        });



    },
    CalculateItem: function (ddlItem, ddlUnit, txtQty, txtPrice ,lbTotal,priceNotChange) {
        var data = {};


        data.ItemId = ddlItem.val();
        data.UnitId = ddlUnit.val();
        if (priceNotChange == null) {
            PwaManager.PwaPost(itemUrl + "GetItemByIdAndUnit", data, function (resObj) {
                if (resObj != null) {
                    txtPrice.val(PwaManager.ConvertToFloating(resObj.Price));
                    lbTotal.text(PwaManager.ConvertToFloating(PwaManager.ConvertToFloating(resObj.Price) * PwaManager.ConvertToFloating(txtQty.val())).toFixed(2));
                } else {
                    txtPrice.val(0);
                    lbTotal.text(0);
                }

                PageController.CalculateSummary();

            });
        } else {
            lbTotal.text(PwaManager.ConvertToFloating(PwaManager.ConvertToFloating(txtPrice.val()) * PwaManager.ConvertToFloating(txtQty.val())).toFixed(2));
            PageController.CalculateSummary();

        }
    },
    CalculateSummary() {
        var summary = 0.00;
        $('table.tbItem  > tbody  > tr').each(function () {

            var row = $(this);


            summary = summary+ PwaManager.ConvertToFloating(row.find(".lbTotal").text());
        });
        $('table.tbItem  > tfoot  > tr:last').find(".lblSummary").text(PwaManager.ConvertToCurrentcy(summary));
    },
    GetCustomerIcon: function (customerShape) {
        return L.geoJson(customerShape, {
            pointToLayer: function (feature, latlng) {
                var smallIcon = new L.Icon({
                    iconSize: [40, 40],

                    iconUrl: currentUrl + '/icon/meter.png'
                });
                return L.marker(latlng, { icon: smallIcon }).bindPopup(popup);
            }
        });
    },

    LoadMap: function () {

        editGroupLayers = new L.FeatureGroup();
        incidentGroupLayer = new L.FeatureGroup();
        pipeGroupLayer = new L.FeatureGroup();

        customerGroupLayer = new L.FeatureGroup();
        SurveyGroupLayer = new L.FeatureGroup();
        PipeImageWmsGroupLayer = new L.FeatureGroup();
        AreaGroupLayer = new L.FeatureGroup();

        historyGroupLayer = new L.FeatureGroup();

        map = L.map('mapid');

        maphistory = L.map('maphistoryid');

        if (maphistory != null) {
            maphistory.setView([13.75030, 100.29520], 17);
            L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
                maxZoom: 17,
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            }).addTo(maphistory);

            maphistory.addLayer(historyGroupLayer);

        }

		if (map != null) {

			map.setView([13.75030, 100.29520],17);
            maptileLayer =   L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
                maxZoom:17,
                subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
            }).addTo(map);

            var scaleControl = new L.control.scale({
                position: 'bottomright'
            }).addTo(map);
            PwaManager.PwaMapAddLayerControl(map);


            map.addLayer(incidentGroupLayer);
            map.addLayer(pipeGroupLayer);
            map.addLayer(editGroupLayers);
            map.addLayer(customerGroupLayer);
            map.addLayer(SurveyGroupLayer);
            map.addLayer(PipeImageWmsGroupLayer);
            map.addLayer(AreaGroupLayer);

			var options = {
				position: 'topright',
				draw: {
					polyline: true,
					polygon: {
						allowIntersection: false, // Restricts shapes to simple polygons
						drawError: {
							color: '#e1e100', // Color the shape will turn when intersects
							message: '<strong>Oh snap!<strong> you can\'t draw that!' // Message that will show when intersect
        }
        },

        circle: false, // Turns off this drawing tool
        rectangle: true,
                    marker: false
        },

        edit: {
        featureGroup: editGroupLayers, //REQUIRED!!
        remove: true
        }
        };


            if ($("#hddTab1SurveyId").val() == "") {
                options.draw.polyline = true;
                options.draw.polygon = true;
                options.draw.rectangle = false;
                options.edit = null;

            }

        var drawControl = new L.Control.Draw(options);

           map.addControl(drawControl);

            mapPrinter = L.easyPrint({
                tileLayer: maptileLayer,
                sizeModes: ['A4Portrait'],
             //   sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
                filename: 'myMap',
                exportOnly: true,
                hideControlContainer: true
            }).addTo(map);

             measureControl = L.control.measure({
                //  control position
                position: 'topleft',
                //  weather to use keyboard control for this plugin
                keyboard: true,
                //  shortcut to activate measure
                activeKeyCode: 'M'.charCodeAt(0),
                //  shortcut to cancel measure, defaults to 'Esc'
                cancelKeyCode: 27,
                //  line color
                lineColor: 'red',
                //  line weight
                lineWeight: 2,
                //  line dash
                lineDashArray: '6, 6',
                //  line opacity
                lineOpacity: 1,
                //  distance formatter
                // formatDistance: function (val) {
                //   return Math.round(1000 * val / 1609.344) / 1000 + 'mile';
                // }
            }).addTo(map)

            map.on('click', onMapClick);
            function onMapClick(e) {

                if (SurveyGroupLayer != null) {
                    SurveyGroupLayer.clearLayers();
                }

                surveMarker = new L.marker(e.latlng, { draggable: 'true' }).bindPopup(PageController.GetMarkerPopup());
                SurveyGroupLayer.addLayer(surveMarker);
            }

            map.on('dblclick', onMapDblClick);
            function onMapDblClick(e) {


                return false;
                if ($("#ddlToolType").val()=="0") {


                       swal({
                title: "สร้าง/เลือกข้อมูล!",
                text: `กรุณาเลือกเครื่องมือในการประเมินผลกระทบ!`,
                timer: 1500,
                type: "warning",
                    });

                    return false;
                }


                if (pipeGroupLayer != null) {
                    pipeGroupLayer.clearLayers();
                }
                if (editGroupLayers != null) {
                    editGroupLayers.clearLayers();
                }

                if (customerGroupLayer != null) {
                    customerGroupLayer.clearLayers();
                }

                if (SurveyGroupLayer != null) {
                    SurveyGroupLayer.clearLayers();
                }



                surveMarker = new L.marker(e.latlng, { draggable: 'true' });
                SurveyGroupLayer.addLayer(surveMarker);

                PageController.AddMarkerMove(surveMarker, SurveyGroupLayer);

                PageController.GetNearPipeAndPoint(surveMarker.getLatLng().lat, surveMarker.getLatLng().lng, PageController.GetIdBySelect2($(".ddlBranch")));
             
            };



         /*   map.on(L.measure.finish, function (evt) {
                log(evt);
            });*/
            map.on(L.Draw.Event.CREATED, function (e) {

                editGroupLayers.clearLayers();

                var type = e.layerType,
                    editLayers  = e.layer;


                console.log(JSON.stringify(editLayers.toGeoJSON().geometry.coordinates))
             //   locationEffectLalong = editLayers.toGeoJSON();
                if (type === 'marker') {
                    layer.bindPopup('จุดที่พบจริง');
                }
                currentToolType = $("#ddlToolType").val();
                editDrawBufferLayers = L.geoJson(editLayers.toGeoJSON(), {});

                editGroupLayers.addLayer(editDrawBufferLayers);

            });
            var lastZoom;
            map.on('zoomend', function () {
                var zoom = map.getZoom();
                if (zoom < 15 && (!lastZoom || lastZoom >= 15)) {
                    map.eachLayer(function (l) {
                        if (l.getTooltip) {
                            var toolTip = l.getTooltip();
                            if (toolTip) {
                                this.map.closeTooltip(toolTip);
                            }
                        }
                    });
                } else if (zoom >= 15 && (!lastZoom || lastZoom < 15)) {
                    map.eachLayer(function (l) {
                        if (l.getTooltip) {
                            var toolTip = l.getTooltip();
                            if (toolTip) {
                                this.map.addLayer(toolTip);
                            }
                        }
                    });
                }
                lastZoom = zoom;
            })
         


       PwaManager.pwaMapPWABranchAndPipe(map, $(".ddlBranch").val(), AreaGroupLayer, PipeImageWmsGroupLayer,false);

         //   WMSUrl = WMSUrl + "&CQL_FILTER=pwa_code=5531029";
       //     WMSUrl = WMSUrl + "&CQL_FILTER=pwa_code=5542017";

         /*   PipeImageWmsGroupLayer.addLayer(
                PipeImageWmsLayer = L.tileLayer.wms(WMSUrl + "&CQL_FILTER=pwa_code=" + resObj.pwacode, {
                    layers: 'PG_WEBGIS:pipeall',
                    transparent: true,
                    format: 'image/png'
                }));
                */



            /*      var reg_zone = L.titleLayer.betterWms(wms_host_orcl, {
          Layers: 'PWA_GIS:ZONE',
          transparent: true,
          format: 'image/png',
          opacity: 0.2
      });*/


          /*  var pipe_all = L.titleLayter.betterWms(WMSUrl, {
                layers: 'PG_WEBGIS:pipeall',
                format: 'image/png',
            });

            pipe_all.addTo(map);

            var meter_all = L.titleLayer.betterWms(WMSUrl, {
                layers: 'PG_WEBGIS:meterall',
                format: 'image/png',
            });*/

        }


    },
    AddMarkerMove: function (currentMaker,GroupLayer) {
        currentMaker.on('dragend', function (event) {
            var marker = event.target;
            currentMaker.setLatLng(new L.LatLng(marker.getLatLng().lat, marker.getLatLng().lng), { draggable: 'true' });
            currentMaker.bindPopup(popupPageController.GetMarkerPopup()).openPopup();
            map.panTo(new L.LatLng(marker.getLatLng().lat, marker.getLatLng().lng))
           // GroupLayer.addLayer(currentMaker);
        });
     

    },
    AddBuffer: function (currentLayer, GroupLayer, size) {

        if (size == "") {
            size = 0;
        }
        var buffered = turf.buffer(currentLayer, size, 'meters');

     /*   var circleGeo = buffered.geometry.coordinates[0];
        var i;
        for (i = 0; i < circleGeo.length; ++i) {
            circleGeo[i] = [circleGeo[i][1], circleGeo[i][0]];
        }
        var pipeLine = L.polygon(circleGeo,
            {
                color: '#589ffc',
                weight: '3',
                fillColor: '#589ffc',
                opacity: 1,
                fillOpacity: 0.2
            }
        );
        */

        GroupLayer.clearLayers();
        GroupLayer.addLayer(L.geoJson(buffered.geometry, {}) );
    },
    AddBuffers: function (pipeGroupLayer, GroupLayer, size) {
        var buffered;
        var circleGeo;
        var circleGeos=[];
        var i;

        GroupLayer.clearLayers();
        pipeGroupLayer.eachLayer(function (currentLayer) {
            buffered = turf.buffer(currentLayer.toGeoJSON(), size, 'meters');
            circleGeo = buffered.geometry.coordinates[0];
            for (i = 0; i < circleGeo.length; ++i) {
                //circleGeos.push(circleGeo[i]);
                circleGeo[i] = [circleGeo[i][1], circleGeo[i][0]];

            }
            var pipeLine = L.polygon(circleGeo,
                {
                    color: '#589ffc',
                    weight: '3',
                    fillColor: '#589ffc',
                    opacity: 1,
                    fillOpacity: 0.2
                }
            );
            GroupLayer.addLayer(L.geoJson(pipeLine.toGeoJSON(), {}));
        });











    },
    GetMarkerPopup: function () {

        var popup = '<div class="panel2">';
        popup += '<div class="panel2-header">';
        popup += '<label class="panel2-title">จุดที่พบ</label>'; 
        popup += '</div>'; 
        popup += ' <div class="panel2-body" style = "padding:10px;">'; 
        popup += "จุดที่พบ<br><button class='btn btn - outline - primary btnEffect'>ยืนยัน</button>&nbsp;<button class='btn btn - outline - danger btnDeleteMaker'>ลบ</button>";
        popup += ' </div>'; 
        popup += '</div >'; 
        return popup;
    },
    SetData: function (model) {

        $(".ddlRequestType").trigger("change");
        $(".ddlRequestCategory").val(model.RequestCategory).selectpicker("refresh");
        $(".ddlRequestCategory").trigger("change");
        $(".ddlRequestCategorySubject").val(model.RequestCategorySubject).selectpicker("refresh");

        $('.nav-item').children("a.active").trigger('click');


        //   $(".nav-link[Status="+($("#hddStatus").val()+1)+"]").trigger("click");



            if (IncidentList != null) {

                $.each(IncidentList, function (index, item) {
                    var html = "";
                    html += "เลขที่แจ้ง :" + item.PwaIncidentNo;
                    html += "<br>ประเภท :" + item.RequestType;
                    html += "<br>ด้าน :" + item.RequestCategory;
                    html += "<br>หัวข้อ :" + item.RequestCategorySubject;

                    if (item.CaseLatitude != null && item.CaseLongtitude != null  && item.CaseLatitude != "" && item.CaseLongtitude != "")
                    incidentGroupLayer.addLayer(L.marker([item.CaseLatitude, item.CaseLongtitude], { icon: incidentMaker }).bindPopup(html));

                });
              PwaManager.pwaMapPWABranchAndPipe(map, $(".ddlBranch").val(), AreaGroupLayer, PipeImageWmsGroupLayer, false);
                if (incidentGroupLayer != null && incidentGroupLayer.getLayers() != null && incidentGroupLayer.getLayers().length > 0) {
                    map.setView([incidentGroupLayer.getBounds().getCenter().lat, incidentGroupLayer.getBounds().getCenter().lng], 17);
                    setTimeout(function () {

                    //    incidentGroupLayer.getLayers()[0].openPopup();
                    }, 2000);
                }

             //   incidentGroupLayer.getLayers()[0].openPopup();
             //   map.fitBounds(incidentGroupLayer.getLayers()[0]);
              //  map.fitBounds(incidentGroupLayer.getLayers()[0].getBounds());
             //   map.setZoom(14);
                /*    mapSurvey.fitBounds(incidentGroupLayer.getBounds());
                    mapSurvey.setZoom(5);
              /      IncidentLayers[0].openPopup();*/
        }

        if (model.Survey != null && model.Survey.Latitude != null && model.Survey.Longtitude != "") {

            surveMarker = L.marker([model.Survey.Latitude, model.Survey.Longtitude], { draggable: 'true' }).bindPopup(PageController.GetMarkerPopup());
            SurveyGroupLayer.addLayer(surveMarker);
            PageController.AddMarkerMove(surveMarker, SurveyGroupLayer);
           
      
              
            /*   if (model.Effect.ToolType == "1") {
                   PageController.AddBuffer(surveMarker.toGeoJSON(), editGroupLayers, $("#txtBuffer").val());
                }
                */

            if (surveMarker != null) {



               // PwaManager.pwaMapStreetView("streetPanorama", surveMarker.getLatLng().lat, surveMarker.getLatLng().lng);
            } else {

              // PwaManager.pwaMapStreetView("streetPanorama");
            }
            map.setView([model.Survey.Latitude, model.Survey.Longtitude], 17);
        } else {
          // PwaManager.pwaMapStreetView("streetPanorama");
        }


        if (model.Effect != null)
        {
         /*   setTimeout(function () {

                PipeImageWmsGroupLayer.clearLayers();
            }, 3000);*/

                if (model.Effect.ToolType == "1") {
                    $(".divBuffer").removeClass("invisible");
                } else if (model.Effect.ToolType == "2") {
                    $(".divBuffer").removeClass("invisible").addClass("invisible");
                } else if (model.Effect.ToolType == "3") {
                    $(".divBuffer").removeClass("invisible").addClass("invisible");
              } else if (model.Effect.ToolType == "4") {
            $(".divBuffer").removeClass("invisible").addClass("invisible");
        }


            if (model.Effect.ShapeGeoJson != null
                && model.Effect.ShapeGeoJson !="") {
                //     locationEffectLalong = $.parseJSON(model.Effect.ShapeGeoJson);
                editDrawBufferLayers = L.geoJson($.parseJSON(model.Effect.ShapeGeoJson), {
                    pointToLayer: function (feature, latlng) {
                        return L.polygon(latlng, polygonStyle);
                    }
                });
                editGroupLayers.addLayer(editDrawBufferLayers);

                var centroidLaLang = editDrawBufferLayers.getBounds().getCenter();
                editGroupLayers.addLayer(editDrawBufferLayers);
                map.setView([editGroupLayers.getBounds().getCenter().lat, editGroupLayers.getBounds().getCenter().lng], 17);
            }
             //   map.setView([centroidLaLang.lat, centroidLaLang.lng], 17);
                var cradius = 100;
                var copts = {
                    parts: 144
                };
         
         //   map.fitBounds(editGroupLayers.getBounds());


                var html = "";



                var geojsonMarkerOptions = {

                    fillColor: 'green',
                    color: 'black',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                };

                var customIcon = L.Icon.extend({
                    options: {
                        iconSize: [40.4, 44],

                    }
                });

                pipeGroupLayer.clearLayers();
                if (model.Effect.PipeEffects != null) {


                    PipeEffectObjs = model.Effect.PipeEffects;
                    $.each(model.Effect.PipeEffects, function (index, item) {

                        var pt = {
                            "type": "Feature",
                            "properties": {},
                            "geometry": {
                                "type": "Point",
                                "coordinates": [14, 100]
                            }
                        };
                        editPipelineBufferLayer = L.geoJson(item.PipeShape, {});



                        pipeGroupLayer.addLayer(editPipelineBufferLayer);
                    //    console.log(item.PipeShape.geometry)





                    });

                    map.setView([pipeGroupLayer.getBounds().getCenter().lat, pipeGroupLayer.getBounds().getCenter().lng], 17);
                    if (model.Effect.ToolType == "1") {
                        PageController.AddBuffer(editDrawBufferLayers.toGeoJSON(), editGroupLayers, PageController.GetIdBySelect2($("#txtBuffer")));
                    }



            }




                $(".divCustEffect").empty();
                html += '<table class="table  table-hover">';
                html += "<thead>";
                html += "<tr>";
                html += ' <th>รหัส</th>';
                html += '<th>ชื่อ</th>';
                html += " </tr>";
                html += " </thead>";
                html += " <tbody>";

                if (model.Effect.CustomerEffects != null) {
                    $.each(model.Effect.CustomerEffects, function (index, item) {

                        item.Shape.geometry.coordinates = item.Shape.geometry.coordinates[0];
                   /*     var markerLayer = L.geoJson(item.Shape, {
                            pointToLayer: function (feature, latlng) {
                                var smallIcon = new L.Icon({
                                    iconSize: [27, 27],
                                    iconAnchor: [13, 27],
                                    popupAnchor: [1, -24],
                                    iconUrl: 'https://www.pngjoy.com/pngl/347/6473115_ubicacion-green-pin-8-icon-png-download.png'
                                });
                                return L.marker(latlng, { icon: smallIcon });
                            }
                        }).bindPopup(item.CustCode)
                        */
                        var popup = '';
                        popup += "รหัสผู้ใช้น้ำ : " + item.CustCode + "<br>";
                        popup += "ชื่อผู้ใช้น้ำ : " + item.CustName + "<br>";
                       // html += "เบอร์โทร : " + item.Telephone + "<br>";

                    //    customerGroupLayer.addLayer(PageController.GetCustomerIcon(item.Shape));
                        customerGroupLayer.addLayer(L.geoJson(item.Shape, {
                            pointToLayer: function (feature, latlng) {
                                var smallIcon = new L.Icon({
                                    iconSize: [32, 32],

                                    iconUrl: currentUrl+'/icon/meter.png'
                                });
                                return L.marker(latlng, { icon: smallIcon }).bindPopup(popup);
                            }
                        }));


                       // customerGroupLayer.getLayers()[0].openPopup();

                        html += "<tr>";
                        html += "<td>" + item.CustCode + "</td>";
                        html += "<td>" + item.CustName + "</td>";

                        html += "</tr>";
                    });

                    html += " </tbody>";
                    html += " </table>";
                    $(".divCustEffect").append(html);
                    $(".divCustEffect table").DataTable({ "searching": false, "bLengthChange": false });
                    //.bindPopup("<b>INC000001</b><br />ท่อแตก."))
                }
                var html = '';
                $(".divAddrEffect").empty();
                html += '<table class="table  table-hover">';
                html += "<thead>";
            html += "<tr>";
            html += ' <th>หมู่ที่</th>';
                html += ' <th>ตำบล</th>';
                html += '<th>อำเภอ</th>';
                html += '<th>จังหวัด</th>';
                html += " </tr>";
                html += " </thead>";
                html += " <tbody>";
                if (model.Effect.CustomerAddrEffects != null) {
                    $.each(model.Effect.CustomerAddrEffects, function (index, item) {
                        html += "<tr>";
                        html += "<td>" + item.VillageNo + "</td>";
                        html += "<td>" + item.TumbolName + "</td>";
                        html += "<td>" + item.AmphurName + "</td>";
                        html += "<td>" + item.ProvinceName + "</td>";
                        html += "</tr>";
                    });
                }

                html += " </tbody>";
                html += " </table>";
                $(".divAddrEffect").append(html);
                $(".divAddrEffect table").DataTable({ "searching": false, "bLengthChange": false });

            }
     //  map.setView([pipeGroupLayer.getBounds().getCenter().lat, pipeGroupLayer.getBounds().getCenter().lng], 17);





    },
    GetIdBySelect2: function (obj) {
      //  var result = obj.select2("data") != null && obj.select2("data").length > 0 ? obj.select2("data")[0].id : null;
        var result = obj != null ? (obj.select2("data") != null && obj.select2("data").length > 0 ? obj.select2("data")[0].id : null) : "";
        return result;
    },
        GetData: function () {
            var objData = {};


        var formData = new FormData();
        objData.RWId = $("#hddRWId").val();
        objData.RWCode = $("#RWCode").val();
        objData.WorkingDate = $("#WorkingDate").val();
        objData.WorkingTime = $("#WorkingTime").val();
      //  objData.RequestType = $("#ddlRequestType").val();
        //    objData.RequestCategory = $("#ddlRequestCategory").val();
         //   objData.RequestCategorySubject = $("#ddlRequestCategorySubject").val();
            objData.RequestType = PageController.GetIdBySelect2($("#ddlRequestType"));
            objData.RequestCategory = PageController.GetIdBySelect2($("#ddlRequestCategory"));
            objData.RequestCategorySubject = PageController.GetIdBySelect2($("#ddlRequestCategorySubject"));
        objData.NotificationDate = $("#NotificationDate").val();
        objData.NotificationTime = $("#NotificationTime").val();
            objData.AccountId = PageController.GetIdBySelect2($("#ddlAccountId"));
            objData.BranchId = PageController.GetIdBySelect2($(".ddlBranch"));
        objData.SLA = $("#chkSLA").is(':checked') ? "1" : "0";
            objData.Reason = PageController.GetIdBySelect2($("#ddlSlaDetail"));  //$("#txtReason").val();
        objData.Status = $("#hddStatus").val();
            objData.DeleteProcessFiles = keepDeleteFiles;

            objData.DeleteCloseFiles = keepDeleteCloseFiles;

            objData.Incidents = [];
            var objItem = {};
            $('#tblDisplay > tbody  > tr').each(function () {
                var row = $(this);
                objItem = {};
                objItem.PwaIncidentID = row.attr("data");

                objData.Incidents.push(objItem);
            });


            if (objData.RowState != "0"  && $("#hddRWId").val() !="" ){

                objData.Status = "5";
        // ------------------------------------ Tab 1  Survey ----------------------------------//
        objData.Survey = {};
        objData.Survey.SurveyId = $("#hddTab1SurveyId").val();
        objData.Survey.RWId = $("#hddRWId").val();
        objData.Survey.SurveyDate = $("#SurveyDate").val();
        objData.Survey.SurveyTime = $("#SurveyTime").val();
        objData.Survey.IsBroken = $("#IsBroken").is(':checked') ? "1" : "0";
                objData.Survey.SurveyAccountId = PageController.GetIdBySelect2($("#ddlSurveyAccountId"));
        objData.Survey.BrokenAppearance = $("#BrokenAppearance").val();
        objData.Survey.PiplineType = $("#PiplineType").val();
        objData.Survey.PiplineSize = $("#PiplineSize").val();
        objData.Survey.SurfaceAppearance = $("#SurfaceAppearance").val();
                objData.Survey.Reason = $("#SurveyReason").val();
                objData.Survey.Location = $("#SurveyLocation").val();
                objData.Survey.Latitude = surveMarker != null ? surveMarker.getLatLng().lat : "";
                objData.Survey.Longtitude = surveMarker != null ? surveMarker.getLatLng().lng : "";
                objData.Survey.ShapeGeoJson = "";
                if (objData.Survey.Longtitude != "" && objData.Survey.Latitude != "") {
                    objData.Survey.ShapeText = "Point (" + objData.Survey.Longtitude + " " + objData.Survey.Latitude + ")";
                } else {
                    objData.Survey.ShapeText = "";
                }
            //    objData.Survey.ShapeText = SurveyGroupLayer.getLayers()[0].getLatLng();//SurveyGroupLayer

                objData.Items = [];
                var objItem = {};
                $('table.tbItem  > tbody  > tr').each(function () {
                    var row = $(this);

                    if (row.find(".selItem").select2('data')[0].id != ""
                        && row.find(".selUnit").select2("data")[0].id != ""
                        && row.find("input.txtQty").val() != ""
                        && row.find("input.txtPrice").val() != ""
                    ) {
                        objItem = {};
                        //   objItem.RWId = objData.CloseJob.CloseJobId;
                        objItem.No = row.find("label.lbNo").text();
                        objItem.ItemId = row.find(".selItem").select2('data')[0].id
                        objItem.ItemName = row.find(".selItem").select2('data')[0].text
                        objItem.UnitId = row.find(".selUnit").select2("data")[0].id;
                        objItem.UnitName = row.find(".selUnit").select2("data")[0].text;
                        objItem.Qty = row.find("input.txtQty").val();
                        objItem.Price = row.find("input.txtPrice").val();
                        objData.Items.push(objItem);
                    }
                });
  // ------------------------------------ Tab 2  Effect ----------------------------------//
                if (editGroupLayers != null && editGroupLayers) {
                objData.Effect = {};
                objData.Effect.EffectId = $("#hddTab2EffectId").val();
                    objData.Effect.RWId = $("#hddRWId").val();
                    objData.Effect.ToolType = $("#ddlToolType").val();
                    objData.Effect.Buffer = PageController.GetIdBySelect2($("#txtBuffer"));


                    editGroupLayers.eachLayer(function (layer) {
                        var mLayer = layer.getLayers()[0];

                        if (objData.Effect.ToolType != "3") {
                            objData.Effect.ShapeGeoJson = JSON.stringify(mLayer.toGeoJSON().geometry);
                            var tempLayer = mLayer.toGeoJSON();
                            tempLayer.geometry.coordinates = JSON.stringify(mLayer.toGeoJSON().geometry.coordinates);
                            objData.Effect.Shape = tempLayer;
                        }
                      /*  objData.Effect.PipeGeoJson = JSON.stringify(mLayer.toGeoJSON());
                        var tempLayer = mLayer.toGeoJSON();
                        tempLayer.geometry.coordinates = JSON.stringify(mLayer.toGeoJSON().geometry.coordinates);
                        objData.Effect.Shape = tempLayer;

                        objData.Effect.PipeEffects = PipeEffectObjs;*/
                    });
                    objData.Effect.PipeEffects = PipeEffectObjs;
          //      objData.Effect.ShapeGeoJson = locationEffectLalong != null ? JSON.stringify(locationEffectLalong) : "";

            //    locationEffectLalong.geometry.coordinates = JSON.stringify(locationEffectLalong.geometry.coordinates);

                //    objData.Effect.Shape = layer.toGeoJSON();
                }
        // ------------------------------------ Tab 2  Open Case ----------------------------------//


                if ($("#hddTab1SurveyId").val() != "" && $("#hddStatus").val() >= 6) {
                    objData.OpenCase = {};
                    objData.OpenCase.OpenCaseId = $("#hddTab3OpenCaseId").val();
                    objData.OpenCase.OpenDate = $("#Tab3OpenDate").val();
                    objData.OpenCase.OpenTime = $("#Tab3OpenTime").val();
                    objData.OpenCase.IsUrgent = $("#Tab3IsUrgent").is(':checked') ? "1" : "0";
                    objData.OpenCase.IsOutSource = $("#Tab3IsOutSource").is(':checked') ? "1" : "0";
                    objData.OpenCase.OpenAccountId = PageController.GetIdBySelect2($("#Tab3OpenAccountId"));
                    objData.OpenCase.ResponAccountId = PageController.GetIdBySelect2($("#Tab3ResponAccountId"));
                    objData.OpenCase.SuperAccountId = PageController.GetIdBySelect2($("#Tab3SuperAccountId"));
                    objData.OpenCase.TeamId = PageController.GetIdBySelect2($("#Tab3TeamId"));
                    objData.OpenCase.IsBroken = $("#Tab3IsBroken").is(':checked') ? "1" : "0";
                    objData.OpenCase.SurveyDate = $("#Tab3SurveyDate").val();
                    objData.OpenCase.SurveyTime = $("#Tab3SurveyTime").val();
                    objData.OpenCase.SurveyAccountId = $("#Tab3SurveyAccountId").val();
                    objData.OpenCase.BrokenAppearance = $("#Tab3BrokenAppearance").val();
                    objData.OpenCase.PiplineType = $("#Tab3PiplineType").val();
                    objData.OpenCase.PiplineSize = $("#Tab3PiplineSize").val();
                    objData.OpenCase.SurfaceAppearance = $("#Tab3SurfaceAppearance").val();
                    objData.OpenCase.Location = $("#Tab3Location").val();
                    objData.OpenCase.Comment = $("#Tab3Comment").val();

                }


        // ------------------------------------ Tab 4  Process ----------------------------------//

                if ($("#hddTab3OpenCaseId").val() != "" && $("#hddStatus").val() >= 7) {
                objData.Process = {};
                objData.Process.ProcessId = $("#hddTab3ProcessId").val();
                objData.Process.IsSuccess = $("#Tab4IsSuccess").is(':checked') ? "1" : "0";
                objData.Process.FromProcessDate = $("#Tab4FromProcessDate").val();
                objData.Process.FromProcessTime = $("#Tab4FromProcessTime").val();
                objData.Process.ToProcessDate = $("#Tab4ToProcessDate").val();
                objData.Process.ToProcessTime = $("#Tab4ToProcessTime").val();
                objData.Process.SurfaceFixedDate = $("#Tab4SurfaceFixedDate").val();
                objData.Process.SurfaceFixedTime = $("#Tab4SurfaceFixedTime").val();
                    objData.Process.SuperAccountId = $("#Tab4SuperAccountId").val();
                    objData.Process.RepaireAccountId = $("#Tab4RepaireAccountId").val();
                objData.Process.BrokenAppearance = $("#Tab4BrokenAppearance").val();
                objData.Process.SurfaceAppearance = $("#Tab4SurfaceAppearance").val();
                objData.Process.ToolType = $("#Tab4ToolType").val();
                objData.Process.HoleWidth = $("#Tab4HoleWidth").val();
                objData.Process.HoleLength = $("#Tab4HoleLength").val();
                objData.Process.HoleDepth = $("#Tab4HoleDepth").val();
                objData.Process.IsOutSource = $("#Tab4IsOutSource").is(':checked') ? "1" : "0";
                objData.Process.Comment = $("#Tab4Comment").val();
                    objData.Process.PiplineSize = $("#Tab4PiplineSize").val();
                    objData.Process.PiplineType = $("#Tab4PiplineType").val();
                    objData.Process.TeamId = $("#Tab4TeamId").val();
                    objData.Process.IsNotGIS = $("#Tab4IsNotGIS").is(':checked') ? "1" : "0"; 



            }


                if ($("#hddTab4ProcessId").val() != "" && $("#hddStatus").val() >= 8) {
                objData.CloseJob = {};

                objData.CloseJob.CloseJobId = $("#hddTab5CloseJobId").val()
                objData.CloseJob.CloseDate = $("#Tab5CloseDate").val()
                objData.CloseJob.CloseTime = $("#Tab5CloseTime").val()
                    objData.CloseJob.DocumentId = $("#Tab5DocumentId").val();



                }
        }

            if ($("#hddTab3OpenCaseId").val() != "") {
                if ($("#file1")[0] != null) formData.append('processfile1', $("#file1")[0].files[0]);
                if ($("#file2")[0] != null) formData.append('processfile2', $("#file2")[0].files[0]);
                if ($("#file3")[0] != null) formData.append('processfile3', $("#file3")[0].files[0]);
                if ($("#file4")[0] != null) formData.append('processfile4', $("#file4")[0].files[0]);
                if ($("#file5")[0] != null) formData.append('processfile5', $("#file5")[0].files[0]);
            }


            var count = 1;
            for (var i = 0; i < $('#pnl_upload_tools .upload').length; i++) {
                var input = $('#pnl_upload_tools .upload').eq(i)[0];
                if (input.files && input.files[0]) {
                    var file_param_name = "closefile" + count++;
                    formData.append(file_param_name, input.files[0]);
                }
            }


            formData.append("Obj", JSON.stringify(objData));
        return formData;
    },
    GetNearPipeAndPoint: function (lat,long, BACode) {
        var data = {
            ShapeText: "Point (" + long + " " + lat + ")",
            BACode: BACode,
            ToolType:$("#ddlToolType").val()
        }
        PwaManager.PwaWaiting(true);
        PwaManager.PwaPost(GISUrl +"GetPipeNearByPoint", data, function (obj) {
            console.log(obj);
            PageController.RefreshPipeAndPointMap(obj);
            PwaManager.PwaWaiting(false);
        }, function (e) {
            PwaManager.PwaWaiting(false);
            });
    },

    GetRepaireHistoryByPipe: function (pipeShapeText, BACode) {
        var selMainPipe;
        if (PipeEffectObjs != null) {
            selMainPipe = PipeEffectObjs.filter(o => o.pipemain == "1");
            if (selMainPipe != null) {
                selMainPipe = selMainPipe[0];

                $(".txtPHLocation").val(selMainPipe.Locate);
                $(".txtPHYear").val(selMainPipe.yearinstall);
                $(".txtPHPipeType").val(selMainPipe.PipeType);
                $(".txtPHPipeSize").val(selMainPipe.PipeSize);
                $(".txtPHPipeLong").val(selMainPipe.longs);
                $(".txtPHPipeDepth").val(selMainPipe.depth);
                $(".txtPHRemark").val(selMainPipe.remark);

            }
        }
        var data = {
            ShapeText: selMainPipe.PipeShapeText,
            BACode: BACode
        }
        PwaManager.PwaWaiting(true);

        historyGroupLayer.clearLayers();
        PwaManager.PwaPost(GISUrl + "GetRepaireHistoryByPipe", data, function (obj) {
            console.log("GetRepaireHistoryByPipe >> " + obj);

            var html = '';

            $(".divPipelineHistoryTable").empty();
            html += '<table class="table  table-hover">';
            html += "<thead>";
            html += "<tr>";
            html += ' <th class="cell-300" scope="col">วันเวลาที่ซ่อม</th>';
            html += '<th scope="col" class="cell-300">สถานที่จุดซ่อม</th>';
            html += '<th scope="col" class="cell-300">สาเหตุที่ท่อรั่ว</th>';
            html += '<th scope="col" class="cell-300">รายละเอียดงานซ่อม</th>';
            html += " </tr>";
            html += " </thead>";
            html += " <tbody>";

            if (obj != null) {
                $.each(obj, function (index, item) {
                    html += ' <tr>';
                    html += ' <td>' + item.repairdate+'</td>';
                    html += ' <td>' + item.locate +'</td>';
                    html += ' <td>' + item.leakcause +'</td>';
                    html += ' <td>' + item.leakdetail + '</td>';
                    html += ' </tr>';

                    historyGroupLayer.addLayer(
                        L.geoJson($.parseJSON(item.leakShapeGeoJson), {}).bindPopup(item.locate,
                            { permanent: true, direction: "center" }
                        )
                    );
                    historyGroupLayer.addLayer(
                        L.geoJson($.parseJSON(item.pipeShapeGeoJson), {})
                    );
                });

                if (historyGroupLayer != null && historyGroupLayer.getLayers().length>0)
                maphistory.setView([historyGroupLayer.getBounds().getCenter().lat, historyGroupLayer.getBounds().getCenter().lng], 15);


               // historyGroupLayer
            //    mapSurvey.fitBounds(historyGroupLayer.getBounds().getCenter());

                html += " </tbody>";
                html += " </table>";

            } else {
                html += " </tbody>";
                html += " </table>";
            }

            $(".divPipelineHistoryTable").append(html);

            $(".divPipelineHistoryTable table").DataTable({ "searching": true, "bLengthChange": false });



          //  PageController.RefreshPipeAndPointMap(obj);
            PwaManager.PwaWaiting(false);

            if (obj != null && obj.length > 0) {
                $("#mdPipeHistory").modal('show');
            } else {
                swal({
                    title: "ไม่พบประวัติการซ่อม!",
                    text: "",
                    timer: 1500
                });
            }

        }, function (e) {
            PwaManager.PwaWaiting(false);
        });
    },
    RefreshPipeAndPointMap: function (PointAndPipeObjList) {
        var realLaLong;
        var PipeAllGeoJson;
        var pipeAllBuffer;
   /*   PointAndPipeObjList[0].ShapeSnape.geometry.coordinates = PointAndPipeObjList[0].ShapeSnape.geometry.coordinates[0];
       PointAndPipeObjList[0].ShapeSnape.properties = {};
        L.geoJson(PointAndPipeObjList[0].ShapeSnape, {
            pointToLayer: function (feature, latlng) {
                realLaLong = latlng;
                return L.marker(latlng, {});
            }
        });*/
        var labelStyle = {
            color: '#CCC',
            opacity: 1
        };
        surveMarker = null;
        // Replace pipe and auto point pipeline
        if (PointAndPipeObjList != null && PointAndPipeObjList.length > 0) {
            if (SurveyGroupLayer != null) {
                SurveyGroupLayer.clearLayers();
            }
            if (pipeGroupLayer != null) {
                pipeGroupLayer.clearLayers();
            }

            PipeEffectObjs = [];

            $.each(PointAndPipeObjList, function (index, pipeDetail) {

                PipeEffectObjs.push({
                    EffectId :""
                    , RWId : $("#hddRWId").val()
                    , PipelineId: pipeDetail.PipelineId
                    , ShapeSnapeText: pipeDetail.ShapeSnapeText
                    , Latitude: ""
                    , Longtitude: ""
                    , longs: pipeDetail.longs
                    , depth: pipeDetail.depth
                    , yearinstall: pipeDetail.yearinstall
                    , remark: pipeDetail.remark
                    , pipemain: pipeDetail.pipemain
                    , ProjectNo: pipeDetail.ProjectNo
                    , PipeSize : pipeDetail.PipeSize
                    , PipeType : pipeDetail.PipeType
                    , Locate: pipeDetail.Locate
                    , PwaCode: pipeDetail.PwaCode
                    , PipeShapeText: pipeDetail.PipeShapeText
                    , PipeGeoJson: pipeDetail.PipeGeoJson

                }
                );
                var refMarker = null;
                var popup = "สถานที่ : " + pipeDetail.Locate;
                popup += "<br>ชนิดท่อ : " + pipeDetail.PipeType;
                popup += "<br>ประเภทท่อ : " + pipeDetail.PipeSize;

                $("#PiplineType").val(pipeDetail.PipeType.trim()).trigger("change");
                $("#PiplineSize").val(pipeDetail.PipeSize.trim()).trigger("change");

               // surveMarker = null;
                if (pipeDetail.ShapeSnapeLa!=null && pipeDetail.ShapeSnapeLa != "") {
                    SurveyGroupLayer.clearLayers();
                    surveMarker = new L.marker([pipeDetail.ShapeSnapeLa, pipeDetail.ShapeSnapeLng], { draggable: 'true' });

                    SurveyGroupLayer.addLayer(surveMarker);
                    PageController.AddMarkerMove(surveMarker, SurveyGroupLayer);
                //   PwaManager.pwaMapStreetView("streetPanorama", pipeDetail.ShapeSnapeLa, pipeDetail.ShapeSnapeLng);
                    map.setView([pipeDetail.ShapeSnapeLa, pipeDetail.ShapeSnapeLng], 17);
                }

                    pipeLayers = $.parseJSON(pipeDetail.PipeGeoJson);





                if (pipeLayers != null) {
                    editPipelineBufferLayer = L.geoJson(pipeLayers, {}).bindTooltip(popup,
                        { permanent: true, direction: "center" }
                    );




                    pipeGroupLayer.addLayer(editPipelineBufferLayer);
                    if ($("#ddlToolType").val() == "1") {
                        if (pipeDetail.PipeAllGeoJson != null && pipeDetail.PipeAllGeoJson != "") {
                            pipeAllBuffer = $.parseJSON(pipeDetail.PipeAllGeoJson);
                            PageController.AddBuffer(pipeAllBuffer, editGroupLayers, PageController.GetIdBySelect2($("#txtBuffer")));
                            console.log("PipeAllGeoJson>>" + pipeAllBuffer)
                        }
                    }


                //    PipeImageWmsGroupLayer.clearLayers();



                }
              /*  if (refMarker != null && $("#ddlToolType").val()=="1") {
                    PageController.AddBuffer(surveMarker.toGeoJSON(), editGroupLayers, $("#txtBuffer").val());

                }*/
                SurveyGroupLayer.addLayer(surveMarker);
            });

         //   var pipeDetail = PointAndPipeObjList[0];



        } else {

            swal({
                title: "ไม่พบเส้นท่อ!",
                text: `ไม่พบเส้นท่อที่ใกล้เคียง หรือเลือกแผนที่ ${$(".ddlBranch").select2("data")[0].text}!`,
                timer: 1500,
                type: "warning",
            });
        }

    },
    Validate: function () {
        var isPass = true;
        var msg = "";

           $('#lblSlaDetail').removeClass("error");
            if ($('#chkSLA').is(':checked')) {
         
                    if ($('#ddlSlaDetail').val() != "0" || $('#ddlSlaDetail').val() != null || $('#ddlSlaDetail').val() != "") {
                        $("#lblSlaDetail").addClass("error");
                        isPass = false;
                    }
         
        }

        $(".lbRequestType").removeClass("error");
        if ($("#ddlRequestType").val() == '0' || $("#ddlRequestType").val() == '' || $("#ddlRequestType").val() == null) {
            $(".lbRequestType").addClass("error");
                isPass = false;
            }

        $(".lbRequestCategory").removeClass("error");
        if ($("#ddlRequestCategory").val() == "0" || $("#ddlRequestCategory").val() == null || $("#ddlRequestCategory").val() == '') {
            $(".lbRequestCategory").addClass("error");
                isPass = false;
            }

        $("#lbRequestCategorySubject").removeClass("error");
        if ($('#ddlRequestCategorySubject').val() == '2') // ท่อแตกท่อรั่ว
            { }
            else {
            if (($("#ddlRequestCategorySubject").val() == "0" || $("#ddlRequestCategorySubject").val() == null || $("#ddlRequestCategorySubject").val() == '')) {
                $(".lbRequestCategorySubject").addClass("error");
                    isPass = false;
                }
        }

        //$("#lblTab3SuperAccountId").removeClass("error");
<<<<<<< .mine

        if ($("#Tab3SuperAccountId").val()!= null) {
            if ($("#Tab3SuperAccountId").val() == "0" || $("#Tab3SuperAccountId").val() == null || $("#Tab3SuperAccountId").val() == '') {
                $("#lblTab3SuperAccountId").addClass("error");
                isPass = false;
            }
        }
||||||| .r1000
        
        if ($("#Tab3SuperAccountId").val() == "0" || $("#Tab3SuperAccountId").val() == null || $("#Tab3SuperAccountId").val() == '') {
            $("#lblTab3SuperAccountId").addClass("error");
            isPass = false;
        }
=======
        
        //if ($("#Tab3SuperAccountId").val() == "0" || $("#Tab3SuperAccountId").val() == null || $("#Tab3SuperAccountId").val() == '') {
        //    $("#lblTab3SuperAccountId").addClass("error");
        //    isPass = false;
        //}
>>>>>>> .r1002

<<<<<<< .mine
        if ($("#Tab4PiplineSize") !=null && $("#Tab4PiplineSize").val() > 50) {
            if ($("#hddTab3OpenCaseId").val() != "") {
||||||| .r1000
        if ($("#Tab4PiplineSize").val() > 50) {
            if ($("#hddTab3OpenCaseId").val() != "") {
=======
        //if ($("#Tab4PiplineSize").val() > 50) {
        //    if ($("#hddTab3OpenCaseId").val() != "") {
>>>>>>> .r1002

        //        if ($("#Tab4IsOutSource").is(':checked')) {
        //            if ($("#file1")[0].files.length == 0
        //                || $("#file2")[0].files.length == 0
        //                || $("#file3")[0].files.length == 0
        //                || $("#file4")[0].files.length == 0
        //                || $("#file5")[0].files.length == 0) {

        //                if (model.Process != null && model.Process.Files != null && model.Process.Files.length < 5) {
        //                    isPass = false;
        //                    msg = "- ดำเนินการซ่อมภาคสนาม\n";
        //                    msg += "กรุณาแนบไฟล์รูปให้ครบ 5 รูป";
        //                }
        //            }
        //        } else {
        //            if ($("#file1")[0].files.length == 0
        //                || $("#file3")[0].files.length == 0
        //                || $("#file5")[0].files.length == 0) {

        //                if (model.Process != null && model.Process.Files != null && model.Process.Files.length < 3) {
        //                    isPass = false;
        //                    msg = "- ดำเนินการซ่อมภาคสนาม\n";
        //                    msg += "กรุณาแนบไฟล์รูป ก่อนซ่อม,	ระหว่างซ่อม,หลังซ่อม";
        //                }
        //            }
        //        }
        //    }
        //}

        if (!isPass) {
            PwaManager.PwaAlert("กรุณากรอกข้อมุลให้ครบถ้วน!", msg);

        }
        return isPass;
    }


        }

    function _upload_file() {
        var full = true;
        for (var i = 0; i < $('#pnl_upload_tools input[type="file"]').length; i++) {
            if ($('#pnl_upload_tools input[type="file"]').eq(i).val() == '') {
                full = false;
                console.log($('#pnl_upload_tools input[type="file"]').eq(i).attr('data-idx'));
                $('#pnl_upload_tools input[type="file"]').eq(i).click();
                break;
            }
        }

        if (full) {
            alert('ไม่สามารถแนบไฟล์ได้มากกว่านี้');
        }
    }

    function readURL(input)
    {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                //$('#blah').attr('src', e.target.result);

                $('.display_upload').append('<div class="upload_item" data-input-id="' + $(input).attr('data-idx') + '">'
                    + '<img src="' + e.target.result + '" onerror="this.src=\'@Url.Content("~/Content/assets/images/icon_file.png")\'"'
                    //+ 'data-toggle="popover"'
                    + 'data-html="true"'
                    + 'data-content="<img src=\'' + e.target.result + '\' style=\'width: 100%;\'></img>"'
                    + 'class="thumbnail" />'
                    + '<i class="glyphicon glyphicon-remove icon-2x text-danger btnDeleteCloseJobfile vertical-align-middle" data="0" data-idx="' + $(input).attr('data-idx') + '"></i>'
                    + '</div>');
            }

            reader.readAsDataURL(input.files[0]); // convert to base64 string
        }
    }
        PageController.init();


</script>

