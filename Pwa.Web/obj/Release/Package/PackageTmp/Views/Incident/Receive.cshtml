@using Pwa.FrameWork.Dao.EF.Smart1662;
@using Pwa.FrameWork.Dto;
@using Pwa.FrameWork.Dto.Smart1662;
@using Pwa.FrameWork.Dto.Smart1662.Incident

@{

    ViewBag.Title = "รับเรื่องร้องเรียน";
    Layout = "~/Views/Shared/_Layout.cshtml";


    List<DropDownlistDto> SysBranchs = (List<DropDownlistDto>
)ViewBag.SysBranchs;

    List<DropDownlistDto> SysChannels = (List<DropDownlistDto>
)ViewBag.SysChannels;

    List<DropDownlistDto> Employees = (List<DropDownlistDto>
)ViewBag.Employees;

    List<DropDownlistDto> Tumbols = (List<DropDownlistDto>
)ViewBag.Tumbols;

    

    List<DropDownlistDto> Titles = (List<DropDownlistDto>
)ViewBag.Titles;
    FileDto fileDto = null;

}

@section Scripts
{
    <!-- -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="~/Scripts/moment.js"></script>
    <script src="~/Scripts/bootstrap-datetimepicker.min.js"></script>


    <link href="~/Content/bootstrap-datetimepicker.min.css" rel="stylesheet" />



    <script type="text/javascript">
        var GetCustomerUrl = '@Url.Action("GetCustomer", "Incident")';
        var GetEmployees = '@Url.Action("GetEmployees", "Incident")';

        var _incidentTypes = @Html.Raw(Json.Encode(ViewBag.IncidentTypes)) ;
        var _provinces = @Html.Raw(Json.Encode(ViewBag.Provinces)) ;
        var _pageInfo = @Html.Raw(Json.Encode(ViewBag.PageInfo)) ;
        var incidentStyle = L.Icon.extend({
            options: {
                iconSize: [27, 27],
                iconAnchor: [38, 86],
                popupAnchor: [-20, -80]
            }
        });

    </script>

    <style>

        .chkSLA {
            padding-top: 30px;
        }

        #mapid {
            height: 100%;
            width: 100%;
        }

        .tab-content {
            padding-top: 15px;
        }

        .modal-open .select2-container {
            z-index: 1700;
        }
    </style>

}
<script src="@Url.Content("~/Scripts/Build/IncidentCaseReceive/bundle.js?ver=1.111")"></script>

@model IncidentDisplayDto

<form id="frmReceiveIncident" action="#" class="" role="form" autocomplete="on" novalidate>
    <div class="container">
        <div class="row" data-plugin="matchHeight" data-by-row="true">
            <div class="col-xxl-12">


                <!-- Contacts Content -->
                <div class="panel panel-primary panel-line">

                    <!-- Contacts Content Header -->
                    <div class="panel-heading">
                        <h1 class="panel-title">รายการร้องเรียน > เพิ่ม/แก้ไข </h1>
                        <div class="page-header-actions">

                        </div>
                    </div>

                    <!-- Contacts Content -->
                    <div class="panel-body" data-plugin="selectable">
                        <div class="row">
                            <div class="panel-title">ผู้แจ้ง</div>
                        </div>
                        <div class="row">
                            <div class="col-md-2 col-lg-2">
                                <div class="form-group">
                                    <label for="ddlTitle">คำนำหน้า</label>
                                    <select id="ddlTitle" class="select2" v-model="incident.Title">
                                        <option value="0">กรุณาเลือก</option>
                                        @foreach (DropDownlistDto it in ViewBag.Titles)
                                        {
                                            <option value="@it.Value" @(it.Value == (Model != null ? Model.Title : "") ? "selected" : "")>@it.Text </option>
                                        }
                                    </select>

                                </div>
                            </div>
                            <div class="col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label for="ddlCustomer">ชื่อ-สกุล</label>
                                    <select id="ddlCustomer" class="select2" v-model="incident.CustomerID">
                                        <option value="0">กรุณาเลือก</option>
                                        @foreach (SelectListItem it in ViewBag.Customers)
                                        {
                                            <option value="@it.Value" @(it.Value == (Model != null ? Model.CustomerID : "") ? "selected" : "")>@it.Text </option>
                                        }
                                    </select>


                                </div>
                            </div>
                            <div class="col-md-4 col-lg-4">
                                <input type="hidden" id="hddInformID" v-model="incident.InformID" value="" />
                                <div class="form-group">
                                    <label for="ddlCustCode">รหัสผู้ใช้น้ำ</label>
                                    <select id="ddlCustCode" class="select2" v-model="incident.CustCode">
                                        <option value="0">กรุณาเลือก</option>
                                        @foreach (DropDownlistDto it in ViewBag.PWACustomerCodes)
                                        {
                                            <option value="@it.Value" @(it.Value == (Model != null ? Model.CustCode : "") ? "selected" : "")>@it.Text </option>
                                        }
                                    </select>

                                </div>
                            </div>
                            <div class="col-md-8 col-lg-8">
                                <div class="form-group ">
                                    <label for="txtAddress">ที่อยู่</label>
                                    <textarea type="text" class="form-control" id="txtAddress" name="txtAddress"
                                              placeholder="">{{incident.CustomerAddress}}</textarea>
                                </div>

                            </div>

                            <div class="col-md-4 col-lg-4">
                                <label for="txtTelephone">เบอร์โทรศัพท์</label>
                                <input type="text" class="form-control" id="txtTelephone" name="txtTelephone" v-model="incident.Telephone"
                                       placeholder="" required />
                            </div>
                            <div class="col-md-8 col-lg-8">
                                <div class="form-group">
                                    <label for="ddlSubDistrict">สถานที่</label>
                                    <select id="ddlSubDistrict" class="select2" v-model="incident.SubDistrict" tabindex="-98">
                                        <option value="">กรุณาเลือก</option>
                                        @foreach (DropDownlistDto it in ViewBag.Tumbols)
                                        {
                                            <option value="@it.Value">@it.Text </option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-4 invisible">
                                <div class="form-group">
                                    <label for="ddlDistrict">อำเภอ</label>
                                    <select id="ddlDistrict" class="select2" v-model="incident.District" tabindex="-98">
                                        <option>อำเภอ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-4 invisible">
                                <div class="form-group">
                                    <label for="ddlProvince">จังหวัด</label>
                                    <select id="ddlProvince" class="select2" v-model="incident.Province" tabindex="-98"></select>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-4">
                                <div class="form-group">
                                    <label for="ddlInformChannel">ช่องทางการแจ้ง</label>
                                    <select id="ddlInformChannel" class="select2" v-model="incident.InformChannelID">
                                        <option value="">ช่องทาง</option>
                                        @foreach (DropDownlistDto it in SysChannels)
                                        {
                                            <option value="@it.Value">@it.Text </option>
                                        }
                                    </select>



                                </div>
                            </div>
                            <div class="col-md-8 col-lg-8">
                                <div class="form-group">
                                    <label for="ddlInformChannelDetail">รายละเอียดช่องทางการแจ้ง</label>
                                    <input type="text" class="form-control" id="ddlInformChannelDetail" v-model="incident.InformReference" placeholder="" />
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xxl-12">
                <!-- Contacts Content -->
                <div class="panel panel-primary panel-line">
                    <div class="panel-heading">
                        <div class="panel-title">การรับแจ้งร้องเรียน</div>
                    </div>
                    <!-- Contacts Content -->
                    <div class="panel-body" data-plugin="selectable">

                        <div class="row">
                            <div class="col-md-3 col-lg-3">
                                <div class="form-group">
                               
                                    <label for="ddlIncidentType">ประเภทการรับแจ้ง</label>
                                    <select id="ddlIncidentType" class="select2" v-model="incident.PwaIncidentTypeID">
                                        <option value="0"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <div class="form-group ">
                                    <label for="txtIncidentNo">เลขที่รับแจ้ง</label>
                                    <input type="text" id="txtIncidentNo" class="form-control" name="name" placeholder="เลขที่รับแจ้ง" v-model="incident.PwaIncidentNo" readonly />
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <div class="form-group">
                                    <label for="txtIncidentNo">ผู้รับแจ้ง</label>
                                    <select class="ddlPwaInformReceiver select2"
                                            id="ddlPwaInformReceiver" v-model="incident.PwaInformReceiver"
                                            tabindex="-98">
                                        <option value="0">ผู้รับแจ้ง</option>
                                        @foreach (DropDownlistDto it in Employees)
                                        {
                                            <option value="@it.Value">@it.Text </option>
                                        }

                                    </select>

                                </div>


                            </div>
                            <div class="col-md-3 col-lg-3">
                                <label for="dtpReceiveCaseDate">วันที่รับแจ้ง</label>
                                <div class='input-group date  incdatetime' id='dtpReceiveCaseDate'>
                                    <input type='text' class="form-control" v-model="incident.ReceivedCaseDate" />
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <div class="form-group">
                                    <label for="ddlIncidentCategory">ด้านการร้องเรียน</label>
                                    <select id="ddlIncidentCategory" class="select2" v-model="incident.PwaIncidentGroupID">
                                        <option></option>
                                    </select>
                                </div>


                            </div>
                            <div class="col-md-2">
                                <div class="form-group chkSLA">
                                    <input type="checkbox" class="icheckbox-primary" id="chkSLA"
                                           v-model="incident.Sla"
                                           data-checkbox-class="icheckbox_flat-blue " />
                                    <label for="inputUnchecked">ยกเว้น SLA</label>
                                </div>

                            </div>
                            <div class="col-md-4 col-lg-4">
                                <div class="form-group">
                                    <label for="">เหตุผล</label>
                                    <select id="ddlSlaDetail" class="select2" v-model="incident.SlaDetail">
                                        <option value="0">เหตุผล</option>
                                        @foreach (DropDownlistDto it in ViewBag.Reasons)
                                        {
                                            <option value="@it.Value" @(it.Value == (Model != null ? Model.SlaDetail : "") ? "selected" : "")>@it.Text </option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <label for="dtpCompletedCaseDate">วันเวลาที่เสร็จ</label>
                                <div class='input-group date  incdatetime' id='dtpCompletedCaseDate'>
                                    <input type='text' class="form-control" v-model="incident.CompletedCaseDate" />
                                    <span class="input-group-addon">
                                        <span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>

                            <div class="col-md-5 col-lg-5">
                                <div class="form-group">
                                    <label for="ddlIncidentTitle">หัวข้อการร้องเรียน</label>
                                    <select id="ddlIncidentTitle" class="select2" tabindex="-98" v-model="incident.CaseTitle">
                                        <option></option>
                                    </select>

                                </div>
                            </div>
                            <div class="col-md-4 col-lg-4">

                                <div class="form-group">
                                    <label for="ddlBranch">สาขา</label>
                                    <select id="ddlBranch" class="select2" v-model="incident.BracnchNo">

                                        @foreach (DropDownlistDto it in SysBranchs)
                                        {
                                            <option value="@it.Value" @(it.Value == (Model != null ? Model.BracnchNo : "") ? "selected" : "")>@it.Text </option>
                                        }

                                    </select>

                                </div>
                            </div>
                            <div class="col-md-3 col-lg-3">
                                <label for="ddlIncidentStatus">สถานะการดำเนินงาน</label>
                                <select id="ddlIncidentStatus" class="selectpicker"
                                        v-model="incident.IncidentStatus"
                                        tabindex="-98">
                                    <option value="1">รับเรื่อง</option>
                                    <option value="9">ปิดเรื่อง</option>
                                </select>
                            </div>
                            <div class="col-md-8 col-lg-8">

                                <div class="form-group">
                                    <label for="">รายละเอียดการรับแจ้ง</label>
                                    <textarea type="text" class="form-control marker"
                                              data-iconlibrary="fa"
                                              rows="10"
                                              name="address" placeholder="รายละเอียด" v-model="incident.CaseDetail"></textarea>
                                </div>
                                @if (Model != null
                                    && Model.Files != null
                                    && Model.Files.Count > 0
                                     && Model.Files.Find(o => o.No == "1") != null)
                                {
                                    fileDto = Model.Files.Find(o => o.No == "1");
                                    <div class="d-flex">
                                        <label class="file-upload btn btn-info btn-outline invisible">
                                            เลือกไฟล์ <input type="file" id="fIncidentImage" />
                                        </label>
                                        <img src="@Url.Content(fileDto.HtmlFile)"
                                             data-toggle="popover"
                                             data-html="true"
                                             data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                             class="thumbnail" />
                                        <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile vertical-align-middle" data="@fileDto.FileID"></i>
                                    </div>
                                }
                                else
                                {
                                    <label class="file-upload btn btn-info btn-outline">
                                        เลือกไฟล์ <input type="file" id="fIncidentImage" />
                                    </label>


                                }



                            </div>
                            <div class="col-md-4 col-lg-4">
                                <div class="form-group">
                                    <label for="txtIncidentAddress">สถานที่เกิดเหตุ</label>
                                    <div class="input-group">
                                        <input type="hidden" id="ddlCaseLatitude" value="" v-model="incident.CaseLatitude" />
                                        <input type="hidden" id="ddlCaseLongtitude" value="" v-model="incident.CaseLongtitude" />
                                        <input type="text" class="form-control" id="txtIncidentAddress" name="txtIncidentAddress" placeholder="" v-model="incident.PwsIncidentAddress" />
                                        <img src="~/Content/assets/images/map.png" style="height:2.573rem" class="btnAddMap" />
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>


            </div>
            <div class="col-xxl-12">
                <div class="panel panel-success panel-line" style="border:0.5px solid #11c26d">
                    <div class="panel-heading">
                        <h3 class="panel-title">การแก้ไขปัญหา</h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-12 col-lg-12">
                                <div class="form-group">
                                    <label for="">อธิบายวิธีการแก้ไข</label>
                                    <textarea type="text" class="form-control marker"
                                              data-iconlibrary="fa"
                                              rows="5"
                                              name="address" placeholder="รายละเอียด" v-model="incident.ResolvedDetail"></textarea>


                                    @if (Model != null
                                   && Model.Files != null
                                   && Model.Files.Count > 0
                                    && Model.Files.Find(o => o.No == "2") != null)
                                    {
                                        fileDto = Model.Files.Find(o => o.No == "2");
                                        <div class="d-flex">
                                            <label class="file-upload btn btn-success btn-outline invisible" style="margin-top:20px">
                                                เลือกไฟล์ <input type="file" id="fResolveImage" />
                                            </label>
                                            <img src="@Url.Content(fileDto.HtmlFile)"
                                                 data-toggle="popover"
                                                 data-html="true"
                                                 data-content="<img src='@Url.Content(fileDto.HtmlFile)' style='width:100%'></img>"
                                                 class="thumbnail" />
                                            <i class="glyphicon glyphicon-remove icon-2x text-danger btnDeletefile vertical-align-middle" data="@fileDto.FileID"></i>
                                        </div>
                                    }
                                    else
                                    {
                                        <label class="file-upload btn btn-success btn-outline " style="margin-top:20px">
                                            เลือกไฟล์ <input type="file" id="fResolveImage" />
                                        </label>


                                    }



                                </div>

                            </div>
                            <div class="col-md-3 col-lg-3">

                                <div class="form-group">
                                    <label for="txtIncidentNo">ผู้บันทึก</label>
                                    <select class="ddlRecorder select2"
                                            id="ddlRecorder" v-model="incident.Recorder"
                                            tabindex="-98">
                                        <option value="0">เลือก</option>
                                        @foreach (DropDownlistDto it in Employees)
                                        {
                                            <option value="@it.Value">@it.Text </option>
                                        }

                                    </select>

                                </div>


                            </div>
                            <div class="col-md-3 col-lg-3">
                                <div class="form-group">
                                    <label for="txtIncidentNo">วันเวลาที่บันทึก</label>
                                    <input type="text" class="form-control datetime" id="txtIncidentRecordDate" placeholder="วันที่บันทึก" v-model="incident.RecordDate">
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

            </div>

            
            <div class="col-xxl-12 text-center">
                <div class="row">
                    <div class="col-md-6 col-lg-6">
                        <div class="panel panel-success panel-line" style="border:0.5px solid #11c26d;display:none" id="pnlFollow" >
                            <div class="panel-heading text-left" >
                                <h3 class="panel-title">รายการติดตาม</h3>
                            </div>
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-md-12 col-lg-12">
                                        <div class="table-responsive " id="divFollowResult" >
                                            <table class="table table-striped" data-animate="fade">
                                                <thead>
                                                    <tr>

                                                        <th class="" scope="col">วันเวลา</th>
                                                        <th class="" scope="col">ช่องทางการติดตาม</th>
                                                        <th class="" scope="col">รายละเอียด</th>
                                                </thead>
                                                <tbody>
                                                    @if (ViewBag.Follows != null) { 
                                                        foreach (var item in ViewBag.Follows)
                                                        {
                                                            <tr>
                                                                <td>@item.Date</td>
                                                                <td >@item.Channel</td>
                                                                <td class="text-left">@item.Detail</td>
                                                            </tr>


                                                        }
                                                    }

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-6">
                        <button type="button" v-on:click="doSubmit" class="btn btn-outline btn-primary">บันทึก</button>
                        <button type="button" class="btn btn-outline btn-default">ยกเลิก</button>
                    </div>
                </div>
                

            </div>


        </div>
    </div>
</form>


<div class="modal modal-primary  fade" id="mdAddCustomer" aria-hidden="true" aria-labelledby="mdAddCustomer"
     role="dialog" tabindex="-1">
    <div class="modal-dialog modal-simple">
        <div class="modal-content">
            <div class="modal-header modal-primary">
                <button type="button" class="close" aria-hidden="true" data-dismiss="modal">×</button>
                <h4 class="modal-title"> ผู้แจ้งร้องเรียน</h4>
            </div>
            <div class="modal-body" style="padding-top:10px">

                <div class="row">
                    <div class="col-md-3 col-lg-3">
                        <div class="form-group">
                            <select data-plugin="selectpicker" class="selectpicker" ย tabindex="-98">
                                <option>นาย</option>
                                <option>นาง</option>
                                <option>นางสาว</option>
                            </select>

                        </div>

                    </div>
                    <div class="col-md-4 col-lg-4">
                        <div class="form-group ">
                            <input type="text" class="form-control" name="name" placeholder="ชื่อ" />
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-5">
                        <div class="form-group">
                            <input type="text" class="form-control" name="phone" placeholder="นามสกุล" />
                        </div>
                    </div>




                </div>
                <div class="row">

                    <div class="col-md-4 col-lg-4">
                        <div class="form-group">
                            <input type="text" class="form-control" name="Line" placeholder="เบอร์โทร" />
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-4">
                        <div class="form-group">
                            <input type="text" class="form-control" name="address" placeholder="รหัสผู้ใช้น้ำ" />
                        </div>
                    </div>
                    <div class="col-md-4 col-lg-4">
                        <div class="form-group">
                            <input type="text" class="form-control" name="address" placeholder="รหัสมิเตอร์" />
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-12 col-lg-12">

                        <textarea type="text" class="form-control" name="desc" placeholder="ที่อยู่"></textarea>

                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal" type="submit">Save</button>
                <a class="btn btn-sm btn-white" data-dismiss="modal" href="javascript:void(0)">Cancel</a>
            </div>
        </div>
    </div>
</div>


<div class="modal modal-primary  fade" id="mdMap" aria-hidden="true" aria-labelledby="mdMap"
     role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header modal-primary">
                <button type="button" class="close" aria-hidden="true" data-dismiss="modal">×</button>
                <h4 class="modal-title">เลือกพื้นที่ผลกระทบ</h4>
            </div>
            <div class="modal-body" style="padding-top:10px">
                <div class="row">
                    <div class="col-md-4">
                        
                    </div>
                    <div class="col-md-8">
                        <div class="form-group">
                            <div class="form-group">


                                <div class="input-search autocomplete">
                                    <input type="text" class="form-control txtSearch" name="" placeholder="ค้นหาพื้นที่...">

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="row">
                            <div class="panel panel-primary panel-line" style="border:0.5px solid #3e8ef7">
                                <div class="panel-heading">
                                    <h3 class="panel-title">ค้นหาข้อร้องเรียน</h3>
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12 col-lg-12">

                                            <div class="form-group ddlProviceSearch">
                                                <label for="ddlProviceSearch">จังหวัด</label>
                                                <select id="ddlProviceSearch" class="select2"></select>


                                            </div>
                                        </div>
                                        <div class="col-md-12 col-lg-12">
                                            <div class="form-group">
                                                <label for="txtDetailSearch">เบอร์โทรศัพท์</label>
                                                <input type="text" class="form-control" id="txtDetailSearch" name="txtDetailSearch" />
                                            </div>
                                        </div>
                                        <div class="col-md-12 col-lg-12">
                                            <div class="form-group">
                                                <label for="txtArea">บริเวณ</label>
                                                <input type="text" class="form-control" id="txtAreaSearch" name="txtArea" />
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <input type='text' class="form-control datetime" id="txtSartDateSearch" placeholder="จากวันที่" />
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <input type='text' class="form-control datetime" id="txtEndDateSearch" placeholder="ถึงวันที่" />
                                            </div>
                                        </div>
                                        <div class="col-md-12 col-lg-12">
                                            <div class="form-group">
                                                <select id="ddlStatusSearch" class="selectpicker" tabindex="1500">
                                                    <option>ทั้งหมด</option>
                                                    <option>ยังไม่เสร็จ</option>
                                                    <option>เสร็จแล้ว</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-xl-12">
                                            <div class=" form-group">
                                                <button class="btn btn-outline-primary">ค้นหา</button>
                                                <button class="btn btn-outline-default">ล้างข้อมูล</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="table-responsive " id="divResult">
                                <table class="table table-striped" data-animate="fade">
                                    <thead>
                                        <tr>

                                            <th class="" scope="col">วันเวลาที่รับแจ้ง</th>
                                            <th class="" scope="col">เลขที่รับแจ้ง</th>
                                            <th class="" scope="col">รายละเอียด</th>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>30/7/2563</td>
                                            <td>S202007020002</td>
                                            <td>ท่อรั่ว</td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>


                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="mapid"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<script>
    var locationSearch = [
        "ActionScript",
        "AppleScript",
        "Asp",
        "BASIC",
        "C",
        "C++",
        "Clojure",
        "COBOL",
        "ColdFusion",
        "Erlang",
        "Fortran",
        "Groovy",
        "Haskell",
        "Java",
        "JavaScript",
        "Lisp",
        "Perl",
        "PHP",
        "Python",
        "Ruby",
        "Scala",
        "Scheme"
    ];

    var map = L.map('mapid').setView([13, 100], 6);
    var lalong;
    var keepDeleteFiles = [];
    var countries = ["Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Anguilla", "Antigua &amp; Barbuda", "Argentina", "Armenia", "Aruba", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bermuda", "Bhutan", "Bolivia", "Bosnia &amp; Herzegovina", "Botswana", "Brazil", "British Virgin Islands", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Cayman Islands", "Central Arfrican Republic", "Chad", "Chile", "China", "Colombia", "Congo", "Cook Islands", "Costa Rica", "Cote D Ivoire", "Croatia", "Cuba", "Curacao", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Ethiopia", "Falkland Islands", "Faroe Islands", "Fiji", "Finland", "France", "French Polynesia", "French West Indies", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Gibraltar", "Greece", "Greenland", "Grenada", "Guam", "Guatemala", "Guernsey", "Guinea", "Guinea Bissau", "Guyana", "Haiti", "Honduras", "Hong Kong", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Isle of Man", "Israel", "Italy", "Jamaica", "Japan", "Jersey", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Macau", "Macedonia", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Montserrat", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauro", "Nepal", "Netherlands", "Netherlands Antilles", "New Caledonia", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Puerto Rico", "Qatar", "Reunion", "Romania", "Russia", "Rwanda", "Saint Pierre &amp; Miquelon", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "St Kitts &amp; Nevis", "St Lucia", "St Vincent", "Sudan", "Suriname", "Swaziland", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor L'Este", "Togo", "Tonga", "Trinidad &amp; Tobago", "Tunisia", "Turkey", "Turkmenistan", "Turks &amp; Caicos", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States of America", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", "Venezuela", "Vietnam", "Virgin Islands (US)", "Yemen", "Zambia", "Zimbabwe"];
    $(document).ready(function () {




        LoadMap();

        $(".select2").select2({ width: '100%' });



        /*   $(".txtSearchLocation").autocomplete({
               source: locationSearch
           });
           */

        /*
        $(".txtSearch").on("keydown", function () {
            var obj = {}


            PwaManager.PwaPost(GetEmployees, obj, function (resObj) {
                PwaManager.PwaAutoComplete($(".txtSearch"), resObj, function (target) {
                    alert(target)
                });
            });

        });*/


        $(".marker").markdown({
            autofocus: false,
            height: 120,
            iconlibrary: 'fa',
            onShow: function (e) {
                //e.hideButtons('cmdPreview');
                e.change(e);
            }
        });
        $(".datetime").datepicker()
        $('.clockpicker').clockpicker();
        $(IncidentMenu).addClass("active");

        $(".btnAddCustomer").on("click", function () {
            $("#mdAddCustomer").modal("show");
        })



    });


    function GetData() {


        return countries;
    }

    $(document).on('change', '#ddlCustomer', function (e) {
        if ($(this).val() != null && $(this).val() != "") {
            //   $("#ddlCustCode").unbind('change');


            SearchCustomer($(this).val(), null);
        }
    });

    $(document).on('change', '#ddlCustCode', function (e) {
        if ($(this).val() != null && $(this).val() != "") {
            //  $("#ddlCustomer").unbind('change');


            //    SearchCustomer(null, $(this).val());
        }
    });
    function SearchCustomer(CustomerId, CustomerCode) {
        var obj = {}
        obj.CustomerId = CustomerId;
        obj.CustomerCode = CustomerCode;
        
        PwaManager.PwaPost(GetCustomerUrl, obj, function (resObj) {
            $("#txtAddress").val(resObj.address_no);
            $("#txtTelephone").val(resObj.tel);
            //     if (CustomerId == null)
            $("#ddlCustCode").val(resObj.CustCode).trigger('change')
            //      else if (CustomerCode == null)
            //   $("#ddlCustomer").val(resObj.CustId).trigger('change').unbind('change');
            $("#ddlProvince").val(resObj.province).trigger('change');
            //     $("#ddlDistrict").val(resObj.amphur).trigger('change');
            //     $("#ddlSubDistrict").val(resObj.district).trigger('change');
            $("#ddlTitle").val(resObj.Title).trigger('change');
            /*
            ddlCustomer
txtAddress


ddlProvince
ddlDistrict
ddlSubDistrict
             */
            console.log(resObj);
        });
    }

    $(document).on('click', '.btnDeletefile', function (e) {


        if ($(this).attr('data') != null) {
            let objProcessFile = {};
            objProcessFile.FileID = $(this).attr('data');
            objProcessFile.PwaIncidentID = $("#hddPwaIncidentID").val();
            objProcessFile.HtmlFile = $(this).closest("div").find("img").attr("src");
            keepDeleteFiles.push(objProcessFile);
            $(this).closest("div").find("img").remove();
            $(this).closest("div").find("label.file-upload").removeClass("invisible");
            $(this).remove();

        }
    });
    $(document).on("show.bs.modal", "#mdMap", function () {
        setTimeout(function () {
            document.getElementById('mdMap').style.display = 'block';
            map.invalidateSize();
        }, 10);
    });
    $(document).on("click", ".btnAddMap", function () {

        $("#mdMap").modal("show");

    });





    function GetIdBySelect2(obj) {
        var result = obj.select2("data") != null && obj.select2("data").length > 0 ? obj.select2("data")[0].id : null;
        return result;
    }

    function GetIdBySelect2(obj, def) {
        var result = obj.select2("data") != null && obj.select2("data").length > 0 ? obj.select2("data")[0].id : def;
        return result;
    }


    function LoadMap() {


        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        var editableLayers = new L.FeatureGroup();
        map.addLayer(editableLayers);

        var options = {
            position: 'topright',
            draw: {
                polyline: false,
                polygon: false,

                circle: false, // Turns off this drawing tool
                rectangle: false,
                marker: true
            },

            edit: {
                featureGroup: editableLayers, //REQUIRED!!
                remove: true
            }
        };


        var drawControl = new L.Control.Draw(options);
        map.addControl(drawControl);

        map.on(L.Draw.Event.CREATED, function (e) {
            editableLayers.clearLayers();
            var type = e.layerType,
                layer = e.layer;

            var lalong = layer.getLatLng();

            console.log(JSON.stringify(lalong));

            try {


                $('#ddlCaseLatitude').val(lalong.lat);
                $('#ddlCaseLongtitude').val(lalong.lng);


            } catch (e) {
                alert(e.message);
            }

            editableLayers.addLayer(layer);
        });

        /*  L.marker([13.756, 100.2018]).addTo(map)
              .bindPopup("<b>สาขา แจ้งวัฒนะ!</b><br />ที่อยู่.....").openPopup();
          L.marker([13.256, 100.2018]).addTo(map)
              .bindPopup("<b>สาขา รังสิต!</b><br />ที่อยู่.....").openPopup();*/
    }

</script>
