@using Pwa.FrameWork.Dto.Smart1662.RepaireWork;
@{
    ViewBag.Title = "งานแจ้งซ่อม";
    Layout = "~/Views/Shared/_Layout.cshtml";

    List<PwaRepaireWorkHeaderDto> GetData = (List<PwaRepaireWorkHeaderDto>
          )ViewData["GetData"];
}


<style>

    .btn .icon {
        width: 1em;
        text-align: center;
        margin: 8px 3px 0;
        line-height: inherit;
    }
    #mapid {
        height: 250px;
        width: 100%;
    }


</style>

<!-- Page -->
<script>
    var GetData = @Html.Raw(Json.Encode(@GetData));

</script>

<div class="row" data-plugin="matchHeight" data-by-row="true">
    <div class="col-xxl-12">


        <div class="example example-buttons pull-right">
            <div class="btn-group btn-group ">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline btn-primary">
                        <i class="icon wb-inbox" aria-hidden="true"></i>  <span class="text-uppercase hidden-sm-down">รอรับเรื่อง</span>
                        <br>
                        <span class="text-uppercase hidden-sm-down">8</span>
                    </button>
                </div>

                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline btn-info">
                        <i class="icon wb-folder" aria-hidden="true"></i>  <span class="text-uppercase hidden-sm-down">กำลังดำเนินการ</span>
                        <br>
                        <span class="text-uppercase hidden-sm-down">3</span>
                    </button>
                </div>

            </div>
        </div>


    </div>
    <div class="col-xxl-12">

        <!-- Contacts Content -->
        <div class="panel panel-primary panel-line">

            <!-- Contacts Content Header -->
            <div class="panel-heading">
                <h1 class="panel-title">กปภ.สาขา > แจ้งซ่อม</h1>
                <div class="page-header-actions">
                    <form></form>
                </div>
            </div>

            <!-- Contacts Content -->
            <div id="contactsContent" class="panel-body" data-plugin="selectable">

                <!-- Actions -->
                <div class="page-content-actions">
                    <div class="row">

                        <div class="col-md-3 col-lg-3">
                            <div class="form-group ">
                                <input type="text" class="form-control" name="txtIncidentNo" placeholder="เลขที่รับแจ้ง" />
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <input type="text" class="form-control" name="txtIncidentHeader" placeholder="หัวข้อ" />
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <input type="text" class="form-control" name="txtIncidentOwner" placeholder="ผู้แจ้ง" />
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <input type="text" class="form-control" name="txtIncidentOwner" placeholder="ผู้รับแจ้ง" />
                            </div>
                        </div>

                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <i class="icon wb-calendar" aria-hidden="true"></i>
                                    </span>
                                    <input type="text" class="form-control datetime" placeholder="วันที่รับแจ้ง" data-plugin="datepicker">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <i class="icon wb-calendar" aria-hidden="true"></i>
                                    </span>
                                    <input type="text" class="form-control date" placeholder="ถึงวันที่รับแจ้ง" data-plugin="datepicker">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <select data-plugin="selectpicker" class="selectpicker" tabindex="-98">
                                    <option>รับเรื่อง</option>
                                    <option>กำลังดำเนินการ</option>
                                    <option>เกินระยะเวลา</option>
                                </select>

                            </div>

                        </div>
                        <div class="col-md-3 col-lg-3">

                            <img src="~/Content/assets/images/map.png" style="height:2.573rem" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <div class="pull-right">
                                <button type="button" class="btn btn-outline btn-primary">ค้นหา</button>
                                <button type="button" class="btn btn-outline btn-default">ยกเลิก</button>
                            </div>
                        </div>

                    </div>
                </div>


                <!-- Contacts -->
               
                <div class="table-responsive divResult">
                    <table class="table is-indent" data-plugin="animateList" data-animate="fade" data-child="tr"
                           data-selectable="selectable">
                        <thead>
                            <tr>
                                <th class="pre-cell"></th>
                                <th class="cell-30" scope="col">
                                    <span class="checkbox-custom checkbox-primary checkbox-lg contacts-select-all">
                                        <input type="checkbox" class="contacts-checkbox selectable-all" id="select_all" />
                                        <label for="select_all"></label>
                                    </span>
                                </th>


                                <th class="" scope="col">วันเวลาที่รับแจ้ง</th>
                                <th class="" scope="col">หัวข้อ</th>
                                <th scope="col" class="">รายละเอียด</th>
                                <th class="" scope="col">สถานที่</th>
                                <th scope="col" class="">สถานะ</th>
                                <th scope="col" class=""></th>
                                <th scope="col" class=""></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-url="panel.tpl" data-toggle="#addUserForm">
                                <td class="pre-cell"></td>
                                <td class="cell-30">
                                    <span class="checkbox-custom checkbox-primary checkbox-lg">
                                        <input type="checkbox" class="contacts-checkbox selectable-item" id="contacts_1" />
                                        <label for="contacts_1"></label>
                                    </span>
                                </td>
                                <td class="">xxxxxxx</td>
                                <td class="">xxxxxxx</td>
                                <td class="">xxxxxxx</td>
                                <td class="">xxxxxxx</td>
                                <td class="">xxxxxxx</td>

                                <td>
                                    <button type="button" class="btn btn-floating btn-success btn-sm btnEdit"><i class="icon wb-pencil" aria-hidden="true"></i></button>
                                </td>
                                <td>   <button type="button" class="btn btn-floating btn-danger btn-sm"><i class="icon wb-close" aria-hidden="true"></i></button></td>
                            </tr>
                         


                        </tbody>
                    </table>
                </div>
        
            </div>
        </div>

    </div>


</div>
<div class="row">

    <div class="col-xxl-12 col-lg-12">
        <div class="panel panel-primary panel-line">
            <div class="panel-heading">
                <h3 class="panel-title">ข้อร้องเรียน</h3>
            </div>
            <div class="panel-body">

                <canvas id="myChart" height="200"></canvas>

            </div>
        </div>

    </div>

</div>


<!-- Site Action -->
<div class="site-action" data-plugin="actionBtn">
    <button type="button" class="site-action-toggle btn-raised btn btn-success btn-floating">
        <i class="front-icon wb-plus animation-scale-up" aria-hidden="true"></i>
        <i class="back-icon wb-close animation-scale-up" aria-hidden="true"></i>
    </button>
    <div class="site-action-buttons">
        <button type="button" data-action="trash" class="btn-raised btn btn-success btn-floating animation-slide-bottom">
            <i class="icon wb-trash" aria-hidden="true"></i>
        </button>
        <button type="button" data-action="folder" class="btn-raised btn btn-success btn-floating animation-slide-bottom">
            <i class="icon wb-folder" aria-hidden="true"></i>
        </button>
    </div>
</div>

<!-- Add User Form -->
<div class="modal fade" id="addUserForm" aria-hidden="true" aria-labelledby="addUserForm"
     role="dialog" tabindex="-1">
    <div class="modal-dialog modal-primary  modal-simple modal-sidebar modal-lg">
        <div class="modal-content">
            <div class="modal-header  ">
                <button type="button" class="close" aria-hidden="true" data-dismiss="modal">×</button>
                <h4 class="modal-title">บันทึกแจ้งซ่อม</h4>
            </div>
            <div class="modal-body" style="background-color:#f1f4f5;padding-top:10px">
                <form>
                    <div class="panel panel-primary panel-line">
                        <div class="panel-heading">
                            <div class="panel-title"> ผู้แจ้งร้องเรียน</div>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <select data-plugin="selectpicker" class="selectpicker" ย tabindex="-98">
                                            <option>นาย</option>
                                            <option>นาง</option>
                                            <option>นางสาว</option>
                                        </select>

                                    </div>

                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group ">
                                        <input type="text" class="form-control" name="name" placeholder="ชื่อ" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="phone" placeholder="นามสกุล" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="Line" placeholder="เบอร์โทร" />
                                    </div>
                                </div>



                            </div>
                            <div class="row">
                                <div class="col-md-6 col-lg-6">
                                    <textarea type="text" class="form-control" name="desc" placeholder="ที่อยู่"></textarea>
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="address" placeholder="รหัสผู้ใช้น้ำ" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="address" placeholder="รหัสมิเตอร์" />
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="panel panel-primary panel-line">
                        <div class="panel-heading">
                            <div class="panel-title">การรับแจ้งซ่อม</div>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-2 col-lg-2">
                                    <div class="form-group">
                                        <select data-plugin="selectpicker" class="selectpicker" tabindex="-98">
                                            <option>ร้องเรียน</option>
                                            <option>ติดตาม</option>
                                            <option>สอบถาม</option>
                                        </select>

                                    </div>

                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group ">
                                        <input type="text" class="form-control" name="name" placeholder="เลขที่รับแจ้ง" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="phone" placeholder="ผู้รับแจ้ง" />
                                    </div>
                                </div>
                                <div class="col-md-2 col-lg-2">
                                    <div class="form-group">
                                        <div class="input-group">

                                            <input type="text" class="form-control datetime" placeholder="วันที่รับแจ้ง" data-plugin="datepicker">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 col-lg-2">
                                    <div class="form-group">
                                        <div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true">
                                            <input type="text" class="form-control" placeholder="เวลา" value="">
                                            <!-- <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-time"></span>
                                            </span>-->
                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="row">
                                <div class="col-md-3- col-lg-3">
                                    <div class="form-group">
                                        <select data-plugin="selectpicker" class="selectpicker" tabindex="-98">
                                            <option>ด้านคุณภาพน้ำ</option>
                                            <option>ด้านปริมาณน้ำ</option>

                                        </select>

                                    </div>

                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <select data-plugin="selectpicker" class="selectpicker" tabindex="-98">
                                            <option>ช่องทางการแจ้ง</option>

                                        </select>

                                    </div>

                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="phone" placeholder="Line ID" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-3">
                                    <div class="form-group">
                                        <select data-plugin="selectpicker" class="selectpicker" tabindex="-98">
                                            <option>สถานะ</option>


                                        </select>

                                    </div>
                                </div>


                            </div>
                            <div class="row">
                                <div class="col-md-5 col-lg-5">
                                    <div class="form-group">
                                        <select data-plugin="selectpicker" class="selectpicker" tabindex="-98">
                                            <option>หัวข้อการร้องเรียน</option>


                                        </select>

                                    </div>

                                </div>
                                <div class="col-md-2 col-lg-2">
                                    <div class="form-group">
                                        <input type="checkbox" class="icheckbox-primary" id="inputUnchecked" name="inputiCheckCheckboxes"
                                               data-plugin="iCheck" data-checkbox-class="icheckbox_flat-blue" />
                                        <label for="inputUnchecked">ยกเว้น SLA</label>
                                    </div>
                                </div>

                                <div class="col-md-5 col-lg-5">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="address" placeholder="เหตุผล" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-lg-6">
                                    <div class="form-group">
                                        <input type="text" class="form-control" name="address" placeholder="หัวข้อ" />
                                    </div>
                                </div>
                                <div class="col-md-3 col-lg-3">

                                    <div class="form-group">
                                        <input type="text" class="form-control" name="address" placeholder="กปภ.สาขา" />
                                    </div>

                                </div>







                            </div>
                            <div class="row">
                                <div class="col-md-6 col-lg-6">
                                    <div class="row">
                                        <div class="col-md-12 col-lg-12">

                                            <div class="panel panel-danger panel-line" style="border:0.5px solid #ff4c52">
                                                <div class="panel-heading">
                                                    <h3 class="panel-title">รายละเอียดเรื่องรับแจ้ง</h3>
                                                </div>
                                                <div class="panel-body">
                                                    <div class="form-group">
                                                        <div class="example example-responsive">
                                                            <textarea type="text" class="form-control marker"
                                                                      data-iconlibrary="fa" data-width="400"
                                                                      name="address" placeholder="รายละเอียด"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <input type="text" class="form-control" name="address" placeholder="ผู้บันทึก" />
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-6">
                                            <div class="form-group">
                                                <div class="input-group">
                                                    <span class="input-group-addon">
                                                        <i class="icon wb-calendar" aria-hidden="true"></i>
                                                    </span>
                                                    <input type="text" class="form-control datetime" placeholder="วันที่บันทึก" data-plugin="datepicker">
                                                </div>
                                            </div>

                                        </div>




                                    </div>



                                </div>
                                <div class="col-md-6 col-lg-6">
                                    <div class="row">
                                        <div class="col-md-12 col-lg-12">
                                            <div class="form-group">
                                                <textarea type="text" class="form-control" rows="3" style="min-width: 100%" name="address" placeholder="สถานที่เกิดเหตุ"></textarea>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="form-group">
                                        <div id="mapid"></div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline btn-primary" data-dismiss="modal" type="submit">รับเรื่อง</button>
                <a class="btn  btn-outline btn-default" data-dismiss="modal" href="javascript:void(0)">ล้างหน้าจอ</a>
            </div>
        </div>
    </div>
</div>
<script src="~/Content/assets/restaurant.geojson.js?ver=4.00"></script>
<script>
     var AddRepaire='@Url.Action("AddRepaire", "Complaint")'
    var map = L.map('mapid').setView([13, 100], 6);
    $(document).ready(function () {

        setTimeout(function () {
            $(ComplaintMenu).slideToggle();
        }, 500
        );

        $(ComplaintMenu).find("li:eq(0)").addClass("active");
        $(".datetime").datepicker();
        LoadMap();
        LoadChart();
        LoadData();
        $(".btnEdit").on("click", function () {

            $(this).closest("tr").attr("data")


        });

        $(".marker").markdown({
            autofocus: false,
            height: 120,
            iconlibrary: 'fa',
            onShow: function (e) {
                //e.hideButtons('cmdPreview');
                e.change(e);
            }
        });


        $('#addUserForm').on('show.bs.modal', function () {
            setTimeout(function () {
                document.getElementById('addUserForm').style.display = 'block';
                map.invalidateSize();
            }, 10);
        })
    });


    function LoadData() {

          var html = '';
            $('.divResult').empty();

            html += '<table class="table table-hover">';
            html += '<thead> ';
            html += '<tr>';

        html += '<th>เลขที่ซ่อม</th>';
        html += '<th>วันเวลาที่รับแจ้ง</th>';
        html += '<th>หัวข้อ</th>';
        html += '<th>รายละเอียด</th>';
        html += '<th>สถานที่</th>';
        html += '<th>สถานะ</th>';
        html += '<th></th>';
        html += '<th></th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

        
        $.each(GetData, function (index, item) {

            html += '<tr data=' + item.RWId + '>';
            html += '<td>' + item.RWCode + '</td>';
            html += '<td>' + item.WorkingDate + '</td>';
            html += '<td>' + item.RequestTypeName + '</td>';
            html += '<td>' + item.Reason + '</td>';
            html += '<td></td>';
            html += '<td>' + item.StatusDesc + '</td>';
            html += '<td><a href = "' + AddRepaire + '/' + item.RWId + '" target = "_self" class="btn btn-sm btn-floating btn-success"><i class="icon wb-pencil" aria-hidden="true"></i></a></td>';
            html += '<td><a class="btn btn-sm btn-floating btn-danger text-white"><i class="icon wb-close" aria-hidden="true"></i></a></td>';

            html += '</tr>';
        });

        html += '</tbody>';
        html += '</table>';
        html += ' </div>';


        $('.divResult').append(html);
        $('.divResult table').DataTable({ "searching": false, "bLengthChange": false});


    }
    function LoadChart() {
        var ctx = document.getElementById('myChart').getContext('2d');

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['ด้านปริมาณน้ำ', 'ด้านท่อแตกรั่ว', 'ด้านคุณภาพน้ำ', 'ด้านบริการ', 'ด้านบุคลากร'],
                datasets: [{
                    label: 'เดือน พฤษภาคม',
                    data: [50, 70, 30, 24, 65],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            },
            responsive: true,
            maintainAspectRatio: false
        });
    }
    function LoadMap() {


        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var editableLayers = new L.FeatureGroup();
        map.addLayer(editableLayers);
        var poiLayers = L.geoJSON(restaurant, {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.city + '<br><b>' + feature.properties.name + '</b>').openPopup();
            }
        });

        L.control.search({
            layer: poiLayers,
            initial: false,
            propertyName: 'name',
            moveToLocation: function (latlng, title, map) {
                //map.fitBounds( latlng.layer.getBounds() );
                var zoom = 12; //map.getBoundsZoom(latlng.layer.getBounds());
                map.setView(latlng, zoom); // access the zoom
            }
        })
            .addTo(map);


        L.circle([13.756, 100.5018], 500, {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5
        }).addTo(map).bindPopup("I am a circle.");

        //L.marker([13.756, 100.2018]).addTo(map)
        //	.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();



        /*


            L.polygon([
                [51.509, -0.08],
                [51.503, -0.06],
                [51.51, -0.047]
            ]).addTo(map).bindPopup("I am a polygon.");

        */
        var popup = L.popup();


        map.on('click', onMapClick);


        var options = {
            position: 'topright',
            draw: {
                polyline: true,
                polygon: {
                    allowIntersection: false, // Restricts shapes to simple polygons
                    drawError: {
                        color: '#e1e100', // Color the shape will turn when intersects
                        message: '<strong>Oh snap!<strong> you can\'t draw that!' // Message that will show when intersect
                    }
                },

                circle: false, // Turns off this drawing tool
                rectangle: true,
                marker: true
            },

            edit: {
                featureGroup: editableLayers, //REQUIRED!!
                remove: true
            }
        };



        var drawControl = new L.Control.Draw(options);
        map.addControl(drawControl);


        map.on(L.Draw.Event.CREATED, function (e) {
            var type = e.layerType,
                layer = e.layer;

            var lalong = layer.getLatLngs();

            console.log(JSON.stringify(layer.toGeoJSON().geometry.coordinates))

            //alert(JSON.stringify(layer.toGeoJSON().geometry.coordinates))
            if (type === 'marker') {
                layer.bindPopup('A popup!');
            }

            editableLayers.addLayer(layer);
        });

    }

    function onMapClick(e) {
        popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(map);
    }


</script>